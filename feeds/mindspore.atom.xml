<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>Welcome to YZSH-HSZY blog. - Mindspore</title><link href="https://yzsh-hszy.github.io/" rel="alternate"/><link href="https://yzsh-hszy.github.io/feeds/mindspore.atom.xml" rel="self"/><id>https://yzsh-hszy.github.io/</id><updated>2024-07-04T12:00:00+08:00</updated><entry><title>Mindspore Learen Notes -- Data Transfroms Operation Learen.</title><link href="https://yzsh-hszy.github.io/2024-07-04-mindspore-learen-notes-data-transfroms-operation-learen.html" rel="alternate"/><published>2024-07-04T12:00:00+08:00</published><updated>2024-07-04T12:00:00+08:00</updated><author><name>YZSH-HSZY</name></author><id>tag:yzsh-hszy.github.io,2024-07-04:/2024-07-04-mindspore-learen-notes-data-transfroms-operation-learen.html</id><summary type="html">&lt;h1&gt;æ•°æ®å˜æ¢ Transforms&lt;/h1&gt;
&lt;p&gt;é€šå¸¸æƒ…å†µä¸‹ï¼Œç›´æ¥åŠ è½½çš„åŸå§‹æ•°æ®å¹¶ä¸èƒ½ç›´æ¥é€å…¥ç¥ç»ç½‘ç»œè¿›è¡Œè®­ç»ƒï¼Œæˆ‘ä»¬éœ€è¦å¯¹å…¶è¿›è¡Œæ•°æ®é¢„å¤„ç†ã€‚MindSporeæä¾›ä¸åŒç§ç±»çš„æ•°æ®å˜æ¢ï¼ˆTransformsï¼‰ï¼Œé… â€¦&lt;/p&gt;</summary><content type="html">&lt;h1&gt;æ•°æ®å˜æ¢ Transforms&lt;/h1&gt;
&lt;p&gt;é€šå¸¸æƒ…å†µä¸‹ï¼Œç›´æ¥åŠ è½½çš„åŸå§‹æ•°æ®å¹¶ä¸èƒ½ç›´æ¥é€å…¥ç¥ç»ç½‘ç»œè¿›è¡Œè®­ç»ƒï¼Œæˆ‘ä»¬éœ€è¦å¯¹å…¶è¿›è¡Œæ•°æ®é¢„å¤„ç†ã€‚MindSporeæä¾›ä¸åŒç§ç±»çš„æ•°æ®å˜æ¢ï¼ˆTransformsï¼‰ï¼Œé…åˆæ•°æ®å¤„ç†Pipelineæ¥å®ç°æ•°æ®é¢„å¤„ç†ã€‚æ‰€æœ‰çš„Transformså‡å¯é€šè¿‡&lt;code&gt;map&lt;/code&gt;æ–¹æ³•ä¼ å…¥ï¼Œå®ç°å¯¹æŒ‡å®šæ•°æ®åˆ—çš„å¤„ç†ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;mindspore.dataset&lt;/code&gt;æä¾›äº†é¢å‘å›¾åƒã€æ–‡æœ¬ã€éŸ³é¢‘ç­‰ä¸åŒæ•°æ®ç±»å‹çš„Transformsï¼ŒåŒæ—¶ä¹Ÿæ”¯æŒä½¿ç”¨Lambdaå‡½æ•°ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-python"&gt;import numpy as np
from PIL import Image
from download import download
from mindspore.dataset import transforms, vision, text
from mindspore.dataset import GeneratorDataset, MnistDataset
print('base moudel import')
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;base moudel import
&lt;/code&gt;&lt;/pre&gt;
&lt;h2&gt;Common Transforms(å¸¸ç”¨å˜æ¢)&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;mindspore.dataset.transforms&lt;/code&gt;æ¨¡å—æ”¯æŒä¸€ç³»åˆ—é€šç”¨Transformsã€‚è¿™é‡Œæˆ‘ä»¬ä»¥&lt;code&gt;Compose&lt;/code&gt;ä¸ºä¾‹ï¼Œä»‹ç»å…¶ä½¿ç”¨æ–¹å¼ã€‚&lt;/p&gt;
&lt;h3&gt;Compose(ç»„åˆ)&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;Compose&lt;/code&gt; æ¥æ”¶ä¸€ä¸ªåºåˆ—ï¼Œåºåˆ—å†…å­˜æ”¾å„ç§æ•°æ®å¢å¼ºæ“ä½œï¼Œç„¶åå°†è¿™å‡ ä¸ªæ•°æ®æ“ä½œåˆå¹¶ä¸ºå•ä¸ªæ•°æ®æ“ä½œã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-python"&gt;# ä»¥MNISTæ•°æ®é›†æ¼”ç¤º
# MNISTæ•°æ®é›†ä¸‹è½½
url = &amp;quot;https://mindspore-website.obs.cn-north-4.myhuaweicloud.com/&amp;quot; \
      &amp;quot;notebook/datasets/MNIST_Data.zip&amp;quot;
path = download(url, &amp;quot;./&amp;quot;, kind=&amp;quot;zip&amp;quot;, replace=True)
train_dataset = MnistDataset('MNIST_Data/train')
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;Downloading data from https://mindspore-website.obs.cn-north-4.myhuaweicloud.com/notebook/datasets/MNIST_Data.zip (10.3 MB)

file_sizes: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 10.8M/10.8M [00:00&amp;lt;00:00, 58.3MB/s]
Extracting zip file...
Successfully downloaded / unzipped to ./
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class="language-python"&gt;# åˆå¹¶å›¾åƒç¼©æ”¾å’Œå½¢çŠ¶å˜æ¢ä¸ºä¸€ä¸ªæ“ä½œ
composed = transforms.Compose(
    [
        vision.Rescale(1.0 / 255.0, 0),
        vision.HWC2CHW()
    ]
)
# åŸimageçš„æ•°æ®ç±»å‹å’Œshape
image, label = next(train_dataset.create_tuple_iterator())
print('before image shape and type is:', image.shape, image.dtype)
# åº”ç”¨åˆå¹¶å˜æ¢æ“ä½œ
train_dataset = train_dataset.map(composed, 'image')
image, label = next(train_dataset.create_tuple_iterator())
print('compose transforms image shape and type is:', image.shape, image.dtype)

&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;before image shape and type is: (28, 28, 1) UInt8
compose transforms image shape and type is: (1, 28, 28) Float32
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ä»ä¸Šè¿°è¾“å‡ºä¸­å¯ä»¥çœ‹åˆ°ï¼Œimageæ•°æ®çš„shapeã€dtypeå‡å‘ç”Ÿå˜åŒ–&lt;/p&gt;
&lt;h2&gt;Vision Transforms(è§†è§‰å˜æ¢)&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;mindspore.dataset.vision&lt;/code&gt; æ¨¡å—æä¾›ä¸€ç³»åˆ—é’ˆå¯¹å›¾åƒæ•°æ®çš„Transformsã€‚&lt;/p&gt;
&lt;h3&gt;Rescale(ç¼©æ”¾)&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;Rescale&lt;/code&gt;å˜æ¢ç”¨äºè°ƒæ•´å›¾åƒåƒç´ å€¼çš„å¤§å°ï¼ŒåŒ…æ‹¬ä¸¤ä¸ªå‚æ•°ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;rescaleï¼šç¼©æ”¾å› å­ã€‚&lt;/li&gt;
&lt;li&gt;shiftï¼šå¹³ç§»å› å­ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å›¾åƒçš„æ¯ä¸ªåƒç´ å°†æ ¹æ®è¿™ä¸¤ä¸ªå‚æ•°è¿›è¡Œè°ƒæ•´ï¼Œè¾“å‡ºçš„åƒç´ å€¼ä¸º$output_{i} = input_{i} * rescale + shift$ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-python"&gt;# è¿™é‡Œæˆ‘ä»¬å…ˆä½¿ç”¨numpyéšæœºç”Ÿæˆä¸€ä¸ªåƒç´ å€¼åœ¨[0, 255]çš„å›¾åƒ
random_np = np.random.randint(0, 255, (4, 4), np.uint8)
random_image = Image.fromarray(random_np)
print('src img data is:\n', random_np)

# å°†å…¶åƒç´ å€¼è¿›è¡Œç¼©æ”¾
rescale_image = vision.Rescale(rescale = 1.0 / 255.0, shift = 1)(random_image)
print('rescale img data is:\n', np.asarray(rescale_image))
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;src img data is:
 [[205 201 102 194]
 [ 80 124 234 241]
 [ 27  62 151 131]
 [ 32 225  37 244]]
rescale img data is:
 [[1.8039216 1.7882353 1.4       1.7607844]
 [1.3137255 1.4862745 1.9176471 1.945098 ]
 [1.1058824 1.2431372 1.5921569 1.5137255]
 [1.1254902 1.882353  1.1450981 1.9568628]]
&lt;/code&gt;&lt;/pre&gt;
&lt;h3&gt;Normalize(å½’ä¸€åŒ–)&lt;/h3&gt;
&lt;p&gt;å˜æ¢ç”¨äºå¯¹è¾“å…¥å›¾åƒçš„å½’ä¸€åŒ–ï¼ŒåŒ…æ‹¬ä¸‰ä¸ªå‚æ•°ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;meanï¼šå›¾åƒæ¯ä¸ªé€šé“çš„å‡å€¼ï¼Œå¿…é¡»ä¸ºä¸€ä¸ªåºåˆ—ï¼Œå¦åˆ™raise TypeError&lt;/li&gt;
&lt;li&gt;stdï¼šå›¾åƒæ¯ä¸ªé€šé“çš„æ ‡å‡†å·®ï¼Œå¿…é¡»ä¸ºä¸€ä¸ªåºåˆ—ï¼Œå¦åˆ™raise TypeError&lt;/li&gt;
&lt;li&gt;is_hwcï¼šboolå€¼ï¼Œè¡¨ç¤ºè¾“å…¥å›¾åƒæ˜¯å¦ä¸ºHWCæ ¼å¼ï¼Œ True ä¸ºHWCæ ¼å¼ï¼Œ False ä¸ºCHWæ ¼å¼ã€‚é»˜è®¤å€¼ï¼š Trueã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å›¾åƒçš„æ¯ä¸ªé€šé“å°†æ ¹æ®&lt;code&gt;mean&lt;/code&gt;å’Œ&lt;code&gt;std&lt;/code&gt;è¿›è¡Œè°ƒæ•´ï¼Œè®¡ç®—å…¬å¼ä¸º$output_{c} = \frac{input_{c} - mean_{c}}{std_{c}}$ï¼Œå…¶ä¸­ $c$ä»£è¡¨é€šé“ç´¢å¼•ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ³¨æ„&lt;/strong&gt; ä»¥(0.2)ä½œä¸ºåºåˆ—ï¼Œä¼šè‡ªåŠ¨å¸åŒ…ï¼Œè€Œ(0.2,)ï¼Œ[0.2]ä¸ä¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-python"&gt;normalize = vision.Normalize(mean=(0.1,), std=[0.3])
random_image = Image.fromarray(np.random.randint(0, 255, (2,3,4), np.uint8))  # hwcæ ¼å¼çš„rgbaå›¾åƒ
normalized_image = normalize(random_image)
print(normalized_image)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;[[[616.3333   186.33333  562.99994  699.6666  ]
  [802.99994  726.3333   123.        16.333332]
  [339.66666  582.99994    9.666667 406.3333  ]]

 [[ 29.666664 173.       739.6666   386.3333  ]
  [626.3333   109.666664 496.33328   46.333332]
  [652.99994  146.33333  809.6666   159.66667 ]]]
&lt;/code&gt;&lt;/pre&gt;
&lt;h3&gt;HWC2CHW&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;HWC2CHW&lt;/code&gt;å˜æ¢ç”¨äºè½¬æ¢å›¾åƒæ ¼å¼ã€‚åœ¨ä¸åŒçš„ç¡¬ä»¶è®¾å¤‡ä¸­å¯èƒ½ä¼šå¯¹(height, width, channel)æˆ–(channel, height, width)ä¸¤ç§ä¸åŒæ ¼å¼æœ‰é’ˆå¯¹æ€§ä¼˜åŒ–ã€‚MindSporeè®¾ç½®HWCä¸ºé»˜è®¤å›¾åƒæ ¼å¼ï¼Œåœ¨æœ‰CHWæ ¼å¼éœ€æ±‚æ—¶ï¼Œå¯ä½¿ç”¨è¯¥å˜æ¢è¿›è¡Œå¤„ç†ã€‚&lt;/p&gt;
&lt;p&gt;å›¾åƒè¿›è¡Œè½¬æ¢ï¼Œåªè½¬æ¢shapeã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-python"&gt;hwc_image = Image.fromarray(np.random.randint(0, 255, (2,3,4), np.uint8))  # hwcæ ¼å¼çš„rgbaå›¾åƒ
chw_image = vision.HWC2CHW()(hwc_image)
print(np.array(hwc_image).shape, chw_image.shape)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;(2, 3, 4) (4, 2, 3)
&lt;/code&gt;&lt;/pre&gt;
&lt;h2&gt;Text Transforms(æ–‡æœ¬å˜æ¢)&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;mindspore.dataset.text&lt;/code&gt;æ¨¡å—æä¾›ä¸€ç³»åˆ—é’ˆå¯¹æ–‡æœ¬æ•°æ®çš„Transformsã€‚ä¸å›¾åƒæ•°æ®ä¸åŒï¼Œæ–‡æœ¬æ•°æ®éœ€è¦æœ‰åˆ†è¯ï¼ˆTokenizeï¼‰ã€æ„å»ºè¯è¡¨ã€Tokenè½¬Indexç­‰æ“ä½œã€‚&lt;/p&gt;
&lt;p&gt;é¦–å…ˆæˆ‘ä»¬å®šä¹‰ä¸‰æ®µæ–‡æœ¬ï¼Œä½œä¸ºå¾…å¤„ç†çš„æ•°æ®ï¼Œå¹¶ä½¿ç”¨&lt;code&gt;GeneratorDataset&lt;/code&gt;è¿›è¡ŒåŠ è½½ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-python"&gt;texts = ['Welcome to Beijing']
test_dataset = GeneratorDataset(texts, 'text')
# æŸ¥çœ‹test_datasetä¸­æ•°æ®æ ¼å¼
text_tensor, = next(test_dataset.create_tuple_iterator())
print(text_tensor, type(text_tensor))
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;Welcome to Beijing &amp;lt;class 'mindspore.common.tensor.Tensor'&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;h3&gt;PythonTokenizer(åˆ†è¯å™¨)&lt;/h3&gt;
&lt;p&gt;åˆ†è¯ï¼ˆTokenizeï¼‰æ“ä½œæ˜¯æ–‡æœ¬æ•°æ®çš„åŸºç¡€å¤„ç†æ–¹æ³•ï¼ŒMindSporeæä¾›å¤šç§ä¸åŒçš„Tokenizerã€‚è¿™é‡Œæˆ‘ä»¬é€‰æ‹©åŸºç¡€çš„&lt;code&gt;PythonTokenizer&lt;/code&gt;ä¸¾ä¾‹ï¼Œå®ƒå…è®¸ç”¨æˆ·è‡ªç”±å®ç°åˆ†è¯ç­–ç•¥ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-python"&gt;test_dataset = test_dataset.map(text.PythonTokenizer(lambda v: v.split()))
print(next(test_dataset.create_tuple_iterator()))
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;[Tensor(shape=[3], dtype=String, value= ['Welcome', 'to', 'Beijing'])]
&lt;/code&gt;&lt;/pre&gt;
&lt;h3&gt;Lookup&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;Lookup&lt;/code&gt;ä¸ºè¯è¡¨æ˜ å°„å˜æ¢ï¼Œç”¨æ¥å°†Tokenè½¬æ¢ä¸ºIndexã€‚åœ¨ä½¿ç”¨&lt;code&gt;Lookup&lt;/code&gt;å‰ï¼Œéœ€è¦æ„é€ è¯è¡¨ï¼Œä¸€èˆ¬å¯ä»¥åŠ è½½å·²æœ‰çš„è¯è¡¨ï¼Œæˆ–ä½¿ç”¨&lt;code&gt;Vocab&lt;/code&gt;ç”Ÿæˆè¯è¡¨ã€‚è¿™é‡Œæˆ‘ä»¬é€‰æ‹©ä½¿ç”¨&lt;code&gt;Vocab.from_dataset&lt;/code&gt;æ–¹æ³•ä»æ•°æ®é›†ä¸­ç”Ÿæˆè¯è¡¨ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-python"&gt;vocab = text.Vocab.from_dataset(test_dataset)
# ä½¿ç”¨`vocab`æ–¹æ³•æŸ¥çœ‹è¯è¡¨
print(vocab.vocab())
# ç”Ÿæˆè¯è¡¨åï¼Œå³å¯é€šè¿‡Lookupæ“ä½œè¿›è¡Œè¯è¡¨æ˜ å°„å˜æ¢ï¼Œå°†Tokenè½¬ä¸ºIndex
test_dataset = test_dataset.map(text.Lookup(vocab))
print(next(test_dataset.create_tuple_iterator()))
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;{'to': 2, 'Welcome': 1, 'Beijing': 0}
[Tensor(shape=[3], dtype=Int32, value= [1, 2, 0])]
&lt;/code&gt;&lt;/pre&gt;
&lt;h2&gt;Lambda Transforms&lt;/h2&gt;
&lt;p&gt;é€šè¿‡Lambda Transformsï¼Œç”¨æˆ·å¯¹ç®€å•çš„å˜æ¢æ“ä½œå¯ä»¥è‡ªå®šä¹‰lambdaå‡½æ•°å®ç°ï¼Œæ›´çµæ´»ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-python"&gt;test_dataset = GeneratorDataset([1, 2, 3], 'data', shuffle=False)
test_dataset = test_dataset.map(lambda x: x * 2)
print(list(test_dataset.create_tuple_iterator()))
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;[[Tensor(shape=[], dtype=Int64, value= 2)], [Tensor(shape=[], dtype=Int64, value= 4)], [Tensor(shape=[], dtype=Int64, value= 6)]]
&lt;/code&gt;&lt;/pre&gt;
&lt;h2&gt;Audio Transforms(éŸ³é¢‘å˜æ¢)&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;mindspore.dataset.audio&lt;/code&gt;æ¨¡å—æä¾›ä¸€ç³»åˆ—é’ˆå¯¹éŸ³é¢‘æ•°æ®çš„Transformsã€‚&lt;a href="https://www.mindspore.cn/docs/zh-CN/r2.3.0/api_python/samples/dataset/audio_gallery.html"&gt;å‚audioæ–‡æ¡£&lt;/a&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-python"&gt;# å®‰è£…librosaåº“
import pip
pip.main(['install', 'librosa'])

import librosa
import numpy as np
import matplotlib.pyplot as plt
import scipy.io.wavfile as wavfile
from IPython.display import Audio
from download import download

import mindspore.dataset as ds
import mindspore.dataset.audio as audio
print('Audioç¯å¢ƒå‡†å¤‡')
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;WARNING: pip is being invoked by an old script wrapper. This will fail in a future version of pip.
Please see https://github.com/pypa/pip/issues/5599 for advice on fixing the underlying issue.
To avoid this problem you can invoke Python with '-m pip' instead of running pip directly.
&lt;/code&gt;&lt;/pre&gt;
&lt;pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"&gt;Looking in indexes: https://pypi.tuna.tsinghua.edu.cn/simple
&lt;/pre&gt;
&lt;pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"&gt;Requirement already satisfied: librosa in /home/nginx/miniconda/envs/jupyter/lib/python3.9/site-packages (0.10.2.post1)
&lt;/pre&gt;
&lt;pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"&gt;Requirement already satisfied: audioread&amp;gt;=2.1.9 in /home/nginx/miniconda/envs/jupyter/lib/python3.9/site-packages (from librosa) (3.0.1)
&lt;/pre&gt;
&lt;pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"&gt;Requirement already satisfied: numpy!=1.22.0,!=1.22.1,!=1.22.2,&amp;gt;=1.20.3 in /home/nginx/miniconda/envs/jupyter/lib/python3.9/site-packages (from librosa) (1.26.4)
&lt;/pre&gt;
&lt;pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"&gt;Requirement already satisfied: scipy&amp;gt;=1.2.0 in /home/nginx/miniconda/envs/jupyter/lib/python3.9/site-packages (from librosa) (1.13.1)
&lt;/pre&gt;
&lt;pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"&gt;Requirement already satisfied: scikit-learn&amp;gt;=0.20.0 in /home/nginx/miniconda/envs/jupyter/lib/python3.9/site-packages (from librosa) (1.5.0)
&lt;/pre&gt;
&lt;pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"&gt;Requirement already satisfied: joblib&amp;gt;=0.14 in /home/nginx/miniconda/envs/jupyter/lib/python3.9/site-packages (from librosa) (1.4.2)
&lt;/pre&gt;
&lt;pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"&gt;Requirement already satisfied: decorator&amp;gt;=4.3.0 in /home/nginx/miniconda/envs/jupyter/lib/python3.9/site-packages (from librosa) (5.1.1)
&lt;/pre&gt;
&lt;pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"&gt;Requirement already satisfied: numba&amp;gt;=0.51.0 in /home/nginx/miniconda/envs/jupyter/lib/python3.9/site-packages (from librosa) (0.60.0)
&lt;/pre&gt;
&lt;pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"&gt;Requirement already satisfied: soundfile&amp;gt;=0.12.1 in /home/nginx/miniconda/envs/jupyter/lib/python3.9/site-packages (from librosa) (0.12.1)
&lt;/pre&gt;
&lt;pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"&gt;Requirement already satisfied: pooch&amp;gt;=1.1 in /home/nginx/miniconda/envs/jupyter/lib/python3.9/site-packages (from librosa) (1.8.2)
&lt;/pre&gt;
&lt;pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"&gt;Requirement already satisfied: soxr&amp;gt;=0.3.2 in /home/nginx/miniconda/envs/jupyter/lib/python3.9/site-packages (from librosa) (0.3.7)
&lt;/pre&gt;
&lt;pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"&gt;Requirement already satisfied: typing-extensions&amp;gt;=4.1.1 in /home/nginx/miniconda/envs/jupyter/lib/python3.9/site-packages (from librosa) (4.11.0)
&lt;/pre&gt;
&lt;pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"&gt;Requirement already satisfied: lazy-loader&amp;gt;=0.1 in /home/nginx/miniconda/envs/jupyter/lib/python3.9/site-packages (from librosa) (0.4)
&lt;/pre&gt;
&lt;pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"&gt;Requirement already satisfied: msgpack&amp;gt;=1.0 in /home/nginx/miniconda/envs/jupyter/lib/python3.9/site-packages (from librosa) (1.0.8)
&lt;/pre&gt;
&lt;pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"&gt;Requirement already satisfied: packaging in /home/nginx/miniconda/envs/jupyter/lib/python3.9/site-packages (from lazy-loader&amp;gt;=0.1-&amp;gt;librosa) (23.2)
&lt;/pre&gt;
&lt;pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"&gt;Requirement already satisfied: llvmlite&amp;lt;0.44,&amp;gt;=0.43.0dev0 in /home/nginx/miniconda/envs/jupyter/lib/python3.9/site-packages (from numba&amp;gt;=0.51.0-&amp;gt;librosa) (0.43.0)
&lt;/pre&gt;
&lt;pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"&gt;Requirement already satisfied: platformdirs&amp;gt;=2.5.0 in /home/nginx/miniconda/envs/jupyter/lib/python3.9/site-packages (from pooch&amp;gt;=1.1-&amp;gt;librosa) (4.2.2)
&lt;/pre&gt;
&lt;pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"&gt;Requirement already satisfied: requests&amp;gt;=2.19.0 in /home/nginx/miniconda/envs/jupyter/lib/python3.9/site-packages (from pooch&amp;gt;=1.1-&amp;gt;librosa) (2.32.3)
&lt;/pre&gt;
&lt;pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"&gt;Requirement already satisfied: threadpoolctl&amp;gt;=3.1.0 in /home/nginx/miniconda/envs/jupyter/lib/python3.9/site-packages (from scikit-learn&amp;gt;=0.20.0-&amp;gt;librosa) (3.5.0)
&lt;/pre&gt;
&lt;pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"&gt;Requirement already satisfied: cffi&amp;gt;=1.0 in /home/nginx/miniconda/envs/jupyter/lib/python3.9/site-packages (from soundfile&amp;gt;=0.12.1-&amp;gt;librosa) (1.16.0)
&lt;/pre&gt;
&lt;pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"&gt;Requirement already satisfied: pycparser in /home/nginx/miniconda/envs/jupyter/lib/python3.9/site-packages (from cffi&amp;gt;=1.0-&amp;gt;soundfile&amp;gt;=0.12.1-&amp;gt;librosa) (2.22)
&lt;/pre&gt;
&lt;pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"&gt;Requirement already satisfied: charset-normalizer&amp;lt;4,&amp;gt;=2 in /home/nginx/miniconda/envs/jupyter/lib/python3.9/site-packages (from requests&amp;gt;=2.19.0-&amp;gt;pooch&amp;gt;=1.1-&amp;gt;librosa) (3.3.2)
&lt;/pre&gt;
&lt;pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"&gt;Requirement already satisfied: idna&amp;lt;4,&amp;gt;=2.5 in /home/nginx/miniconda/envs/jupyter/lib/python3.9/site-packages (from requests&amp;gt;=2.19.0-&amp;gt;pooch&amp;gt;=1.1-&amp;gt;librosa) (3.7)
&lt;/pre&gt;
&lt;pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"&gt;Requirement already satisfied: urllib3&amp;lt;3,&amp;gt;=1.21.1 in /home/nginx/miniconda/envs/jupyter/lib/python3.9/site-packages (from requests&amp;gt;=2.19.0-&amp;gt;pooch&amp;gt;=1.1-&amp;gt;librosa) (2.2.2)
&lt;/pre&gt;
&lt;pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"&gt;Requirement already satisfied: certifi&amp;gt;=2017.4.17 in /home/nginx/miniconda/envs/jupyter/lib/python3.9/site-packages (from requests&amp;gt;=2.19.0-&amp;gt;pooch&amp;gt;=1.1-&amp;gt;librosa) (2024.6.2)
&lt;/pre&gt;
&lt;pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"&gt;
&lt;span style="font-weight: bold"&gt;[&lt;/span&gt;&lt;span style="color: #000080; text-decoration-color: #000080; background-color: #ffffff"&gt;notice&lt;/span&gt;&lt;span style="color: #000000; text-decoration-color: #000000; background-color: #ffffff; font-weight: bold"&gt;]&lt;/span&gt;&lt;span style="color: #000000; text-decoration-color: #000000; background-color: #ffffff"&gt; A new release of pip is available: &lt;/span&gt;&lt;span style="color: #800000; text-decoration-color: #800000; background-color: #ffffff"&gt;24.1&lt;/span&gt;&lt;span style="color: #000000; text-decoration-color: #000000; background-color: #ffffff"&gt; -&amp;gt; &lt;/span&gt;&lt;span style="color: #008000; text-decoration-color: #008000; background-color: #ffffff"&gt;24.1.2&lt;/span&gt;
&lt;span style="font-weight: bold"&gt;[&lt;/span&gt;&lt;span style="color: #000080; text-decoration-color: #000080; background-color: #ffffff"&gt;notice&lt;/span&gt;&lt;span style="color: #000000; text-decoration-color: #000000; background-color: #ffffff; font-weight: bold"&gt;]&lt;/span&gt;&lt;span style="color: #000000; text-decoration-color: #000000; background-color: #ffffff"&gt; To update, run: &lt;/span&gt;&lt;span style="color: #008000; text-decoration-color: #008000; background-color: #ffffff"&gt;python -m pip install --upgrade pip&lt;/span&gt;
&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;Audioç¯å¢ƒå‡†å¤‡
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class="language-python"&gt;# ä¸‹è½½éŸ³é¢‘wavæ–‡ä»¶
url = &amp;quot;https://mindspore-website.obs.cn-north-4.myhuaweicloud.com/notebook/datasets/84-121123-0000.wav&amp;quot;
download(url, './84-121123-0000.wav', replace=True)
wav_file = &amp;quot;84-121123-0000.wav&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;Downloading data from https://mindspore-website.obs.cn-north-4.myhuaweicloud.com/notebook/datasets/84-121123-0000.wav (65 kB)

file_sizes: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 67.0k/67.0k [00:00&amp;lt;00:00, 25.9MB/s]
Successfully downloaded file to ./84-121123-0000.wav
&lt;/code&gt;&lt;/pre&gt;
&lt;h3&gt;Spectrogram&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;Spectrogram&lt;/code&gt; ç”¨äºä»éŸ³é¢‘ä¿¡å·åˆ›å»ºå…¶é¢‘è°±&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-python"&gt;# è¯»å–éŸ³é¢‘æ–‡ä»¶
sample_rate, waveform = wavfile.read(wav_file)

def plot_waveform(waveform, sr, title=&amp;quot;Waveform&amp;quot;):
    &amp;quot;&amp;quot;&amp;quot; ç»˜åˆ¶éŸ³é¢‘æ³¢å½¢å›¾ &amp;quot;&amp;quot;&amp;quot;
    if waveform.ndim == 1:
        waveform = waveform[np.newaxis, :]
    num_channels, num_frames = waveform.shape
    time_axis = np.arange(0, num_frames) / sr

    figure, axes = plt.subplots(num_channels, 1)
    axes.plot(time_axis, waveform[0], linewidth=1)
    axes.grid(True)
    figure.suptitle(title)
    plt.show(block=False)
    
def plot_spectrogram(specgram, title=None, ylabel=&amp;quot;freq_bin&amp;quot;):
    &amp;quot;&amp;quot;&amp;quot; ç»˜åˆ¶éŸ³é¢‘å…‰è°±å›¾ &amp;quot;&amp;quot;&amp;quot;
    fig, axs = plt.subplots(1, 1)
    axs.set_title(title or &amp;quot;Spectrogram (db)&amp;quot;)
    axs.set_ylabel(ylabel)
    axs.set_xlabel(&amp;quot;frame&amp;quot;)
    im = axs.imshow(librosa.power_to_db(specgram), origin=&amp;quot;lower&amp;quot;, aspect=&amp;quot;auto&amp;quot;)
    fig.colorbar(im, ax=axs)
    plt.show(block=False)

plot_waveform(waveform, sample_rate, title=&amp;quot;Original waveform&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src="/static/mindspore/fourth-blog_files/fourth-blog_25_0.png" alt="png" /&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-python"&gt;# è¿›è¡ŒSpectrogramå˜æ¢
n_fft = 1024
win_length = None
hop_length = 512

# Define transform
spectrogram = audio.Spectrogram(
    n_fft=n_fft,
    win_length=win_length,
    hop_length=hop_length,
    center=True,
    pad_mode=audio.BorderType.REFLECT,
    power=2.0,
)

spec = spectrogram(waveform)
plot_spectrogram(spec, title=&amp;quot;audio&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src="/static/mindspore/fourth-blog_files/fourth-blog_26_0.png" alt="png" /&gt;&lt;/p&gt;
&lt;h3&gt;GriffinLim&lt;/h3&gt;
&lt;p&gt;ä»çº¿æ€§å¹…åº¦é¢‘è°±å›¾æ¢å¤ä¿¡å·æ³¢å½¢&lt;/p&gt;
&lt;h3&gt;Mel Filter Bank&lt;/h3&gt;
&lt;p&gt;mindspore.dataset.audio.melscale_fbanks å¯ä»¥åˆ›å»ºé¢‘ç‡å˜æ¢çŸ©é˜µã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-python"&gt;from datetime import datetime
import pytz
print(datetime.now(pytz.timezone('Asia/Shanghai')), '\nuser:YZSH-HSZY')
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;2024-07-19 18:33:26.985327+08:00 
user:YZSH-HSZY
&lt;/code&gt;&lt;/pre&gt;
</content><category term="Mindspore"/></entry><entry><title>Mindspore Learen Notes -- Construct Dataset.</title><link href="https://yzsh-hszy.github.io/2024-07-03-mindspore-learen-notes-construct-dataset.html" rel="alternate"/><published>2024-07-03T12:00:00+08:00</published><updated>2024-07-03T12:00:00+08:00</updated><author><name>YZSH-HSZY</name></author><id>tag:yzsh-hszy.github.io,2024-07-03:/2024-07-03-mindspore-learen-notes-construct-dataset.html</id><summary type="html">&lt;h2&gt;æ•°æ®é›† Dataset&lt;/h2&gt;
&lt;p&gt;æ•°æ®æ˜¯æ·±åº¦å­¦ä¹ çš„åŸºç¡€ï¼Œé«˜è´¨é‡çš„æ•°æ®è¾“å…¥å°†åœ¨æ•´ä¸ªæ·±åº¦ç¥ç»ç½‘ç»œä¸­èµ·åˆ°ç§¯æä½œç”¨ã€‚MindSporeæä¾›åŸºäºPipelineçš„æ•°æ®å¼•æ“ï¼Œé€šè¿‡æ•°æ®é›†ï¼ˆDatasetï¼‰å’Œæ•°æ®å˜ â€¦&lt;/p&gt;</summary><content type="html">&lt;h2&gt;æ•°æ®é›† Dataset&lt;/h2&gt;
&lt;p&gt;æ•°æ®æ˜¯æ·±åº¦å­¦ä¹ çš„åŸºç¡€ï¼Œé«˜è´¨é‡çš„æ•°æ®è¾“å…¥å°†åœ¨æ•´ä¸ªæ·±åº¦ç¥ç»ç½‘ç»œä¸­èµ·åˆ°ç§¯æä½œç”¨ã€‚MindSporeæä¾›åŸºäºPipelineçš„æ•°æ®å¼•æ“ï¼Œé€šè¿‡æ•°æ®é›†ï¼ˆDatasetï¼‰å’Œæ•°æ®å˜æ¢ï¼ˆTransformsï¼‰å®ç°é«˜æ•ˆçš„æ•°æ®é¢„å¤„ç†ã€‚å…¶ä¸­Datasetæ˜¯Pipelineçš„èµ·å§‹ï¼Œç”¨äºåŠ è½½åŸå§‹æ•°æ®ã€‚mindspore.datasetæä¾›äº†å†…ç½®çš„æ–‡æœ¬ã€å›¾åƒã€éŸ³é¢‘ç­‰æ•°æ®é›†åŠ è½½æ¥å£ï¼Œå¹¶æä¾›äº†è‡ªå®šä¹‰æ•°æ®é›†åŠ è½½æ¥å£ã€‚&lt;/p&gt;
&lt;p&gt;æ­¤å¤–MindSporeçš„é¢†åŸŸå¼€å‘åº“ä¹Ÿæä¾›äº†å¤§é‡çš„é¢„åŠ è½½æ•°æ®é›†ï¼Œå¯ä»¥ä½¿ç”¨APIä¸€é”®ä¸‹è½½ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;h3&gt;åè¯ä»‹ç»&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;æ•°æ®å¼•æ“ï¼šç”¨äºå°†æ•°æ®é›†é«˜æ•ˆã€çµæ´»çš„è½¬æ¢è‡³Tensorï¼Œå¹¶å°†è¯¥Tensoræä¾›ç»™è®­ç»ƒç½‘ç»œç”¨äºè®­ç»ƒï¼Œmindsporeæ•°æ®å¼•æ“æ˜¯å°†åœ¨æ·±åº¦å­¦ä¹ è¿‡ç¨‹ä¸­æ•°æ®è¾“å…¥åˆ°ç½‘ç»œè¿™ä¸€ä¸­é—´ç¯å¢ƒç»™æŠ½å–å‡ºæ¥çš„ä¸€ä¸ªä¸­é—´ä»¶ï¼Œæ”¯æŒpythonæˆ–c++æ’ä»¶ï¼Œæ”¯æŒå¤šç«¯æ•°æ®å¤„ç†ã€‚&lt;/li&gt;
&lt;li&gt;Transformsæ•°æ®å˜æ¢ï¼šé€šå¸¸æƒ…å†µä¸‹ï¼Œç›´æ¥åŠ è½½çš„åŸå§‹æ•°æ®å¹¶ä¸èƒ½ç›´æ¥é€å…¥ç¥ç»ç½‘ç»œè¿›è¡Œè®­ç»ƒï¼Œæˆ‘ä»¬éœ€è¦å¯¹å…¶è¿›è¡Œæ•°æ®é¢„å¤„ç†ã€‚MindSporeæä¾›ä¸€ä¸ªç”¨äºä¸åŒç§ç±»çš„æ•°æ®è¿›è¡Œå˜æ¢çš„é€šç”¨å±‚mindspore.dataset.transformsï¼Œé…åˆæ•°æ®å¤„ç†Pipelineæ¥å®ç°æ•°æ®é¢„å¤„ç†ã€‚æ‰€æœ‰çš„Transformså‡å¯é€šè¿‡mapæ–¹æ³•ä¼ å…¥ï¼Œå®ç°å¯¹æŒ‡å®šæ•°æ®åˆ—çš„å¤„ç†ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code class="language-python"&gt;import numpy as np
import mindspore.dataset as ds
from mindspore.dataset import vision
from mindspore.dataset import MnistDataset, GeneratorDataset
import matplotlib.pyplot as plt
print('base moudle import')
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;base moudle import
&lt;/code&gt;&lt;/pre&gt;
&lt;h3&gt;æ•°æ®é›†åŠ è½½&lt;/h3&gt;
&lt;p&gt;ä½¿ç”¨&lt;strong&gt;Mnist&lt;/strong&gt;æ•°æ®é›†ä½œä¸ºæ ·ä¾‹ï¼Œä»‹ç»ä½¿ç”¨&lt;code&gt;mindspore.dataset&lt;/code&gt;è¿›è¡ŒåŠ è½½çš„æ–¹æ³•ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ³¨æ„&lt;/strong&gt; &lt;code&gt;mindspore.dataset&lt;/code&gt;æä¾›çš„æ¥å£&lt;strong&gt;ä»…æ”¯æŒè§£å‹åçš„æ•°æ®æ–‡ä»¶&lt;/strong&gt;ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨&lt;code&gt;download&lt;/code&gt;åº“ä¸‹è½½æ•°æ®é›†å¹¶è§£å‹ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-python"&gt;# mnistæ•°æ®é›†ä¸‹è½½
from download import download

url = &amp;quot;https://mindspore-website.obs.cn-north-4.myhuaweicloud.com/&amp;quot; \
      &amp;quot;notebook/datasets/MNIST_Data.zip&amp;quot;
path = download(url, &amp;quot;./&amp;quot;, kind=&amp;quot;zip&amp;quot;, replace=True)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;Downloading data from https://mindspore-website.obs.cn-north-4.myhuaweicloud.com/notebook/datasets/MNIST_Data.zip (10.3 MB)

file_sizes: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 10.8M/10.8M [00:00&amp;lt;00:00, 154MB/s]
Extracting zip file...
Successfully downloaded / unzipped to ./
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class="language-python"&gt;# ç›´æ¥é€šè¿‡mindspore.datasetå†…ç½®çš„MnistDatasetç±»è¿›è¡Œmnistæ•°æ®åŠ è½½
train_dataset = MnistDataset(&amp;quot;MNIST_Data/train&amp;quot;, shuffle=False)
print(type(train_dataset))
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;&amp;lt;class 'mindspore.dataset.engine.datasets_vision.MnistDataset'&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;h3&gt;æ•°æ®é›†è¿­ä»£&lt;/h3&gt;
&lt;p&gt;æ•°æ®é›†åŠ è½½åï¼Œä¸€èˆ¬ä»¥è¿­ä»£æ–¹å¼è·å–æ•°æ®ï¼Œç„¶åé€å…¥ç¥ç»ç½‘ç»œä¸­è¿›è¡Œè®­ç»ƒã€‚mindspore.datasetæä¾›create_tuple_iteratorå’Œcreate_dict_iteratoræ¥å£ç”¨äºåˆ›å»ºæ•°æ®è¿­ä»£å™¨ï¼Œè¿­ä»£è®¿é—®æ•°æ®ã€‚&lt;/p&gt;
&lt;p&gt;è®¿é—®çš„æ•°æ®ç±»å‹é»˜è®¤ä¸º&lt;code&gt;Tensor&lt;/code&gt;ï¼›è‹¥è®¾ç½®&lt;code&gt;output_numpy=True&lt;/code&gt;ï¼Œè®¿é—®çš„æ•°æ®ç±»å‹ä¸º&lt;code&gt;Numpy&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-python"&gt;for idx, item in enumerate(train_dataset.create_tuple_iterator()):
    if idx == 1: break
    print(
        'the create_tuple_iterator generate`s iter length is :', len(item), 
        '\nthe iter item type is :', type(item),
        '\nelement in iter item type is :', [type(i) for i in item]
    )
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;the create_tuple_iterator generate`s iter length is : 2 
the iter item type is : &amp;lt;class 'list'&amp;gt; 
element in iter item type is : [&amp;lt;class 'mindspore.common.tensor.Tensor'&amp;gt;, &amp;lt;class 'mindspore.common.tensor.Tensor'&amp;gt;]
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ç¼–å†™å¯è§†åŒ–å‡½æ•°æŸ¥çœ‹mnistæ‰‹å†™æ•°å­—è¯†åˆ«æ•°æ®é›†ä¸­å›¾åƒæ•°æ®&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-python"&gt;def visualize(dataset):
    figure = plt.figure(figsize=(4, 4))
    cols, rows = 3, 3
    plt.subplots_adjust(wspace=0.5, hspace=0.5)
    for idx, (image, label) in enumerate(dataset.create_tuple_iterator()):
        figure.add_subplot(rows, cols, idx + 1)
        plt.title(int(label))
        plt.axis(&amp;quot;off&amp;quot;)
        plt.imshow(image.asnumpy().squeeze(), cmap=&amp;quot;gray&amp;quot;)
        if idx == cols * rows - 1:
            break
    plt.show()
visualize(train_dataset)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src="/static/mindspore/third-blog_files/third-blog_9_0.png" alt="png" /&gt;&lt;/p&gt;
&lt;h3&gt;æ•°æ®é›†å¸¸ç”¨æ“ä½œ&lt;/h3&gt;
&lt;p&gt;Pipelineçš„è®¾è®¡ç†å¿µä½¿å¾—æ•°æ®é›†çš„å¸¸ç”¨æ“ä½œé‡‡ç”¨&lt;code&gt;dataset = dataset.operation()&lt;/code&gt;çš„å¼‚æ­¥æ‰§è¡Œæ–¹å¼ï¼Œæ‰§è¡Œæ“ä½œè¿”å›æ–°çš„Datasetï¼Œæ­¤æ—¶ä¸æ‰§è¡Œå…·ä½“æ“ä½œï¼Œè€Œæ˜¯åœ¨Pipelineä¸­åŠ å…¥èŠ‚ç‚¹ï¼Œæœ€ç»ˆè¿›è¡Œè¿­ä»£æ—¶ï¼Œå¹¶è¡Œæ‰§è¡Œæ•´ä¸ªPipelineã€‚&lt;/p&gt;
&lt;h4&gt;shuffle&lt;/h4&gt;
&lt;p&gt;æ•°æ®é›†éšæœº&lt;code&gt;shuffle&lt;/code&gt;å¯ä»¥æ¶ˆé™¤æ•°æ®æ’åˆ—é€ æˆçš„åˆ†å¸ƒä¸å‡é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;mindspore.dataset&lt;/code&gt;æä¾›çš„æ•°æ®é›†åœ¨åŠ è½½æ—¶å¯é…ç½®&lt;code&gt;shuffle=True&lt;/code&gt;ï¼Œæˆ–ç›´æ¥å¯¹æ•°æ®é›†ä½¿ç”¨&lt;code&gt;shuffle&lt;/code&gt;æ–¹æ³•è·å–æ–°éšæœºæ•°æ®é›†&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-python"&gt;# å‚æ•°buffer_sizeå¿…é¡»ï¼Œä¸ºè¿›è¡Œæ•°æ®é‡æ’æ—¶æ¯è¡Œå¤§å°
train_dataset = train_dataset.shuffle(buffer_size=4)
visualize(train_dataset)
# ä»ä¸‹å›¾ä¸­å¯ä»¥çœ‹åˆ°æ•°æ®é¡ºåºå‘ç”Ÿå˜åŒ–
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src="/static/mindspore/third-blog_files/third-blog_12_0.png" alt="png" /&gt;&lt;/p&gt;
&lt;h4&gt;map&lt;/h4&gt;
&lt;p&gt;&lt;code&gt;map&lt;/code&gt;æ“ä½œæ˜¯æ•°æ®é¢„å¤„ç†çš„å…³é”®æ“ä½œï¼Œå¯ä»¥é’ˆå¯¹æ•°æ®é›†æŒ‡å®šåˆ—ï¼ˆcolumnï¼‰æ·»åŠ æ•°æ®å˜æ¢ï¼ˆTransformsï¼‰ï¼Œå°†æ•°æ®å˜æ¢åº”ç”¨äºè¯¥åˆ—æ•°æ®çš„æ¯ä¸ªå…ƒç´ ï¼Œå¹¶è¿”å›åŒ…å«å˜æ¢åå…ƒç´ çš„æ–°æ•°æ®é›†ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-python"&gt;# å¦‚ä½•æŸ¥çœ‹æ•°æ®é›†åˆ—åï¼Œå¯ä»¥é€šè¿‡create_dict_iteratorçš„dict.keysé›†åˆè·å–
print('train_dataset columns name is:', next(train_dataset.create_dict_iterator()).keys())
image, label = next(train_dataset.create_tuple_iterator())
print('img data shape and type is:', image.shape, image.dtype)
print('label data shape and type is:', label.shape, label.dtype)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;train_dataset columns name is: dict_keys(['image', 'label'])
img data shape and type is: (28, 28, 1) UInt8
label data shape and type is: () UInt32
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class="language-python"&gt;from itertools import product
train_dataset = MnistDataset(&amp;quot;MNIST_Data/train&amp;quot;, shuffle=False)  # é‡æ–°åŠ è½½æ•°æ®é›†
image, label = next(train_dataset.create_tuple_iterator())
print('a image shape is:', image.shape)
# æŸ¥çœ‹ç¬¬ä¸€å¼ å›¾ç‰‡æ‰€æœ‰éé›¶å€¼
the_first_no_zeros_sign = False
the_first_no_zeros_index = None
for i in product(*[range(s) for s in image.shape]):
    if image.item(i):
        if not the_first_no_zeros_sign: 
            print('the first no zeros index is:', i)
            the_first_no_zeros_index, the_first_no_zeros_sign = i, True
            print('first image all no zeros', end=':')
        print(image.item(i), end='-')
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;a image shape is: (28, 28, 1)
the first no zeros index is: (5, 12, 0)
first image all no zeros:3-18-18-18-126-136-175-26-166-255-247-127-30-36-94-154-170-253-253-253-253-253-225-172-253-242-195-64-49-238-253-253-253-253-253-253-253-253-251-93-82-82-56-39-18-219-253-253-253-253-253-198-182-247-241-80-156-107-253-253-205-11-43-154-14-1-154-253-90-139-253-190-2-11-190-253-70-35-241-225-160-108-1-81-240-253-253-119-25-45-186-253-253-150-27-16-93-252-253-187-249-253-249-64-46-130-183-253-253-207-2-39-148-229-253-253-253-250-182-24-114-221-253-253-253-253-201-78-23-66-213-253-253-253-253-198-81-2-18-171-219-253-253-253-253-195-80-9-55-172-226-253-253-253-253-244-133-11-136-253-253-253-212-135-132-16-
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class="language-python"&gt;# é€šè¿‡visionçš„è§†è§‰æ“ä½œè¿›è¡Œimageåˆ—å¤„ç†
train_dataset = MnistDataset(&amp;quot;MNIST_Data/train&amp;quot;, shuffle=False)  # é‡æ–°åŠ è½½æ•°æ®é›†
train_dataset = train_dataset.map(vision.Rescale(1.0 / 255.0, 0), input_columns='image')
image, label = next(train_dataset.create_tuple_iterator())
print('map op then first image shape and type is:', image.shape, image.dtype)
print('the first no zeros index is:', the_first_no_zeros_index)
print('the uint8 to float32 value is:', image.item(the_first_no_zeros_index))
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;map op then first image shape and type is: (28, 28, 1) Float32
the first no zeros index is: (5, 12, 0)
the uint8 to float32 value is: 0.011764707
&lt;/code&gt;&lt;/pre&gt;
&lt;h4&gt;batch&lt;/h4&gt;
&lt;p&gt;å°†æ•°æ®é›†æ‰“åŒ…ä¸ºå›ºå®šå¤§å°çš„&lt;code&gt;batch&lt;/code&gt;æ˜¯åœ¨æœ‰é™ç¡¬ä»¶èµ„æºä¸‹ä½¿ç”¨æ¢¯åº¦ä¸‹é™è¿›è¡Œæ¨¡å‹ä¼˜åŒ–çš„æŠ˜ä¸­æ–¹æ³•ï¼Œå¯ä»¥ä¿è¯æ¢¯åº¦ä¸‹é™çš„éšæœºæ€§å’Œä¼˜åŒ–è®¡ç®—é‡ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€èˆ¬æˆ‘ä»¬ä¼šè®¾ç½®ä¸€ä¸ªå›ºå®šçš„batch sizeï¼Œå°†è¿ç»­çš„æ•°æ®åˆ†ä¸ºè‹¥å¹²æ‰¹ï¼ˆbatchï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ³¨æ„&lt;/strong&gt; &lt;code&gt;batch&lt;/code&gt;æ“ä½œåçš„æ•°æ®å¢åŠ ä¸€ç»´ï¼Œå¤§å°ä¸º&lt;code&gt;batch_size&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-python"&gt;train_dataset = train_dataset.batch(batch_size=4)
image, label = next(train_dataset.create_tuple_iterator())
print(image.shape, image.dtype)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;(4, 28, 28, 1) Float32
&lt;/code&gt;&lt;/pre&gt;
&lt;h3&gt;è‡ªå®šä¹‰æ•°æ®é›†&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;mindspore.dataset&lt;/code&gt;æ¨¡å—æä¾›äº†ä¸€äº›å¸¸ç”¨çš„å…¬å¼€æ•°æ®é›†å’Œæ ‡å‡†æ ¼å¼æ•°æ®é›†çš„åŠ è½½APIã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äºMindSporeæš‚ä¸æ”¯æŒç›´æ¥åŠ è½½çš„æ•°æ®é›†ï¼Œå¯ä»¥æ„é€ è‡ªå®šä¹‰æ•°æ®åŠ è½½ç±»æˆ–è‡ªå®šä¹‰æ•°æ®é›†ç”Ÿæˆå‡½æ•°çš„æ–¹å¼æ¥ç”Ÿæˆæ•°æ®é›†ï¼Œç„¶åé€šè¿‡&lt;code&gt;GeneratorDataset&lt;/code&gt;æ¥å£å®ç°è‡ªå®šä¹‰æ–¹å¼çš„æ•°æ®é›†åŠ è½½ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;GeneratorDataset&lt;/code&gt;æ”¯æŒé€šè¿‡å¯éšæœºè®¿é—®æ•°æ®é›†å¯¹è±¡ã€å¯è¿­ä»£æ•°æ®é›†å¯¹è±¡å’Œç”Ÿæˆå™¨(generator)æ„é€ è‡ªå®šä¹‰æ•°æ®é›†&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å¯éšæœºè®¿é—®æ•°æ®é›†&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å¯éšæœºè®¿é—®æ•°æ®é›†æ˜¯å®ç°äº†&lt;code&gt;__getitem__&lt;/code&gt;å’Œ&lt;code&gt;__len__&lt;/code&gt;æ–¹æ³•çš„æ•°æ®é›†ï¼Œè¡¨ç¤ºå¯ä»¥é€šè¿‡ç´¢å¼•/é”®ç›´æ¥è®¿é—®å¯¹åº”ä½ç½®çš„æ•°æ®æ ·æœ¬ã€‚&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚ï¼Œå½“ä½¿ç”¨&lt;code&gt;dataset[idx]&lt;/code&gt;è®¿é—®è¿™æ ·çš„æ•°æ®é›†æ—¶ï¼Œå¯ä»¥è¯»å–datasetå†…å®¹ä¸­ç¬¬idxä¸ªæ ·æœ¬æˆ–æ ‡ç­¾ï¼Œè¯¥æ¡æ•°æ®å¯ä»¥é€šè¿‡GeneratorDatasetæ¥å£è½¬æ¢ä¸ºTensorç±»å‹ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ³¨æ„&lt;/strong&gt; å¯éšæœºè®¿é—®æ•°æ®é›†åœ¨ç”Ÿæˆè¿­ä»£Tensorç»„æ—¶ï¼Œæ˜¯éšæœºè·å–çš„&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-python"&gt;# å¯éšæœºè®¿é—®æ•°æ®é›†ï¼ŒåŒ…å«5ç»„æ•°æ®
class RandomAccessDataset:
    def __init__(self):
        self._data = np.eye(5, k=1)
        self._label = np.zeros((5, 1))

    def __getitem__(self, index):
        return self._data[index], self._label[index]

    def __len__(self):
        return len(self._data)
# è‡ªå®šä¹‰æ•°æ®é›†è½¬æ¢ä¸ºmindsporeå¯æ“ä½œçš„dataset
loader = RandomAccessDataset()
dataset = GeneratorDataset(source=loader, column_names=[&amp;quot;data&amp;quot;, &amp;quot;label&amp;quot;])
# æ•°æ®éšæœº
for data, label in dataset.create_tuple_iterator():
    print(data, ';', label)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;[0. 0. 0. 0. 0.] ; [0.]
[0. 0. 1. 0. 0.] ; [0.]
[0. 0. 0. 0. 1.] ; [0.]
[0. 1. 0. 0. 0.] ; [0.]
[0. 0. 0. 1. 0.] ; [0.]
&lt;/code&gt;&lt;/pre&gt;
&lt;ol start="2"&gt;
&lt;li&gt;å¯è¿­ä»£æ•°æ®é›†&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å¯è¿­ä»£çš„æ•°æ®é›†æ˜¯å®ç°äº†&lt;code&gt;__iter__&lt;/code&gt;å’Œ&lt;code&gt;__next__&lt;/code&gt;æ–¹æ³•çš„æ•°æ®é›†ï¼Œè¡¨ç¤ºå¯ä»¥é€šè¿‡è¿­ä»£çš„æ–¹å¼é€æ­¥è·å–æ•°æ®æ ·æœ¬ã€‚è¿™ç§ç±»å‹çš„æ•°æ®é›†ç‰¹åˆ«é€‚ç”¨äºéšæœºè®¿é—®æˆæœ¬å¤ªé«˜æˆ–è€…ä¸å¯è¡Œçš„æƒ…å†µã€‚&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚ï¼Œå½“ä½¿ç”¨&lt;code&gt;iter(dataset)&lt;/code&gt;çš„å½¢å¼è®¿é—®æ•°æ®é›†æ—¶ï¼Œå¯ä»¥è¯»å–ä»æ•°æ®åº“ã€è¿œç¨‹æœåŠ¡å™¨è¿”å›çš„æ•°æ®æµã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æ„é€ ä¸€ä¸ªç®€å•è¿­ä»£å™¨ï¼Œå¹¶å°†å…¶åŠ è½½è‡³&lt;code&gt;GeneratorDataset&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-python"&gt;# å¯è¿­ä»£æ•°æ®é›†
class IterableDataset():
    def __init__(self, start, end):
        '''åˆå§‹åŒ–è¿­ä»£å™¨å‚æ•°'''
        self.start = start
        self.end = end
    def __next__(self):
        '''è·å–ä¸‹ä¸€è¿­ä»£æ•°æ®'''
        return next(self.data)
    def __iter__(self):
        '''åˆ›å»ºè¿­ä»£'''
        self.data = iter(range(self.start, self.end))
        return self
loader = IterableDataset(1, 5)
dataset = GeneratorDataset(source=loader, column_names=[&amp;quot;data&amp;quot;])
# in dataset é»˜è®¤è°ƒç”¨create_tuple_iterator()ï¼Œä¼šå°†Tensoræ•°æ®å°è£…è¿›tuple
for d in dataset:
    print(d)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;[Tensor(shape=[], dtype=Int64, value= 1)]
[Tensor(shape=[], dtype=Int64, value= 2)]
[Tensor(shape=[], dtype=Int64, value= 3)]
[Tensor(shape=[], dtype=Int64, value= 4)]
&lt;/code&gt;&lt;/pre&gt;
&lt;ol start="3"&gt;
&lt;li&gt;ç”Ÿæˆå™¨&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ç”Ÿæˆå™¨ä¹Ÿå±äºå¯è¿­ä»£çš„æ•°æ®é›†ç±»å‹ï¼Œå…¶ç›´æ¥ä¾èµ–Pythonçš„ç”Ÿæˆå™¨ç±»å‹&lt;code&gt;generator&lt;/code&gt;è¿”å›æ•°æ®ï¼Œç›´è‡³ç”Ÿæˆå™¨æŠ›å‡º&lt;code&gt;StopIteration&lt;/code&gt;å¼‚å¸¸ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æ„é€ ä¸€ä¸ªç”Ÿæˆå™¨ï¼Œå¹¶å°†å…¶åŠ è½½è‡³&lt;code&gt;GeneratorDataset&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-python"&gt;# ç”Ÿæˆå™¨æ„é€ dataset
dataset = GeneratorDataset(source=iter(range(1,5)), column_names=[&amp;quot;data&amp;quot;])
for i in dataset:
    print(i)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;[Tensor(shape=[], dtype=Int64, value= 1)]
[Tensor(shape=[], dtype=Int64, value= 2)]
[Tensor(shape=[], dtype=Int64, value= 3)]
[Tensor(shape=[], dtype=Int64, value= 4)]
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class="language-python"&gt;from datetime import datetime
import pytz
print(datetime.now(pytz.timezone('Asia/Shanghai')), '\nuser:YZSH-HSZY')
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;2024-07-04 23:39:18.933937+08:00 
user:YZSH-HSZY
&lt;/code&gt;&lt;/pre&gt;
</content><category term="Mindspore"/></entry><entry><title>Mindspore Learen Notes -- Tensor Understand.</title><link href="https://yzsh-hszy.github.io/2024-07-02-mindspore-learen-notes-tensor-understand.html" rel="alternate"/><published>2024-07-02T12:00:00+08:00</published><updated>2024-07-02T12:00:00+08:00</updated><author><name>YZSH-HSZY</name></author><id>tag:yzsh-hszy.github.io,2024-07-02:/2024-07-02-mindspore-learen-notes-tensor-understand.html</id><summary type="html">&lt;h2&gt;å¼ é‡ä»‹ç»&lt;/h2&gt;
&lt;p&gt;å¼ é‡ï¼ˆTensorï¼‰æ˜¯ä¸€ä¸ªå¯ç”¨æ¥è¡¨ç¤ºåœ¨ä¸€äº›çŸ¢é‡ã€æ ‡é‡å’Œå…¶ä»–å¼ é‡ä¹‹é—´çš„çº¿æ€§å…³ç³»çš„å¤šçº¿æ€§å‡½æ•°ï¼Œè¿™äº›çº¿æ€§å…³ç³»çš„åŸºæœ¬ä¾‹ â€¦&lt;/p&gt;</summary><content type="html">&lt;h2&gt;å¼ é‡ä»‹ç»&lt;/h2&gt;
&lt;p&gt;å¼ é‡ï¼ˆTensorï¼‰æ˜¯ä¸€ä¸ªå¯ç”¨æ¥è¡¨ç¤ºåœ¨ä¸€äº›çŸ¢é‡ã€æ ‡é‡å’Œå…¶ä»–å¼ é‡ä¹‹é—´çš„çº¿æ€§å…³ç³»çš„å¤šçº¿æ€§å‡½æ•°ï¼Œè¿™äº›çº¿æ€§å…³ç³»çš„åŸºæœ¬ä¾‹å­æœ‰å†…ç§¯ã€å¤–ç§¯ã€çº¿æ€§æ˜ å°„ä»¥åŠç¬›å¡å„¿ç§¯ã€‚å…¶åæ ‡åœ¨ ğ‘› ç»´ç©ºé—´å†…ï¼Œæœ‰ $n^r$ ä¸ªåˆ†é‡çš„ä¸€ç§é‡ï¼Œå…¶ä¸­æ¯ä¸ªåˆ†é‡éƒ½æ˜¯åæ ‡çš„å‡½æ•°ï¼Œè€Œåœ¨åæ ‡å˜æ¢æ—¶ï¼Œè¿™äº›åˆ†é‡ä¹Ÿä¾ç…§æŸäº›è§„åˆ™ä½œçº¿æ€§å˜æ¢ã€‚ ğ‘Ÿ ç§°ä¸ºè¯¥å¼ é‡çš„ç§©æˆ–é˜¶ï¼ˆä¸çŸ©é˜µçš„ç§©å’Œé˜¶å‡æ— å…³ç³»ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ³¨æ„&lt;/strong&gt; å¼ é‡æ˜¯ä¸€ç§ç‰¹æ®Šçš„æ•°æ®ç»“æ„ï¼Œä¸æ•°ç»„å’ŒçŸ©é˜µéå¸¸ç›¸ä¼¼ã€‚å¼ é‡ï¼ˆTensorï¼‰æ˜¯MindSporeç½‘ç»œè¿ç®—ä¸­çš„åŸºæœ¬æ•°æ®ç»“æ„ï¼Œæœ¬æ•™ç¨‹ä¸»è¦ä»‹ç»å¼ é‡å’Œç¨€ç–å¼ é‡çš„å±æ€§åŠç”¨æ³•ã€‚&lt;/p&gt;
&lt;h2&gt;å¼ é‡ä¸çŸ©é˜µä¸æ•°ç»„ä¸å‘é‡çš„åŒºåˆ«&lt;/h2&gt;
&lt;p&gt;åœ¨numpyä¸­ï¼Œæ•°æ®çš„ç»“æ„æœ‰æ•°ç»„ã€çŸ©é˜µã€å‘é‡è¿™å‡ ç§æè¿°æ–¹å¼ï¼Œè€Œåœ¨æ·±åº¦å­¦ä¹ ä¸­é€šå¸¸ä½¿ç”¨å¼ é‡æ¥æè¿°æ‰€æœ‰æ•°æ®å’Œç›¸åº”çš„å˜æ¢å…³ç³»ã€‚åœ¨å‚ä¸è¿ç®—æ—¶ä»–ä»¬ä¹‹é—´çš„å·®è·é€šå¸¸éå¸¸å°ï¼Œä½†å´æ˜¯ä¸åŒè§’åº¦ä¸‹çš„æè¿°ï¼Œå› æ­¤æ­£ç¡®çš„ç†è§£å¹¶åŒºåˆ†ä»–ä»¬æ˜¯å¿…è¦çš„ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-python"&gt;# mindspore base moudel import
import numpy as np
import mindspore
from mindspore import ops
from mindspore import Tensor, CSRTensor, COOTensor
print('moudel import success')
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;moudel import success
&lt;/code&gt;&lt;/pre&gt;
&lt;h3&gt;a base tensor create&lt;/h3&gt;
&lt;p&gt;æ„é€ å¼ é‡æ—¶ï¼Œæ”¯æŒä¼ å…¥Tensorã€floatã€intã€boolã€tupleã€listã€complexå’Œnumpy.ndarrayç±»å‹ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æ ¹æ®æ•°æ®ç›´æ¥ç”Ÿæˆ
å¯ä»¥æ ¹æ®æ•°æ®åˆ›å»ºå¼ é‡ï¼Œæ•°æ®ç±»å‹å¯ä»¥è®¾ç½®æˆ–è€…é€šè¿‡æ¡†æ¶è‡ªåŠ¨æ¨æ–­ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code class="language-python"&gt;# pythonåŸç”Ÿç±»å‹
int_tensor = Tensor(1)
float_tensor = Tensor(1.)
bool_tensor = Tensor(True)
tuple_tensor = Tensor((1,2))
list_tensor = Tensor([1,3])
complex_tensor = Tensor(complex(1,9))
temp_dict = locals()
for k,v in temp_dict.items():
    if k.endswith('tensor') and isinstance(v, Tensor):
        print(
            k, 
            ';value is :', v,
            ';shape is :', v.shape,
            ';dtype is :', v.dtype
        )
# Tensorã€numpy.ndarrayç±»å‹
nd_tensor = Tensor(np.array([[1,2],[3,4]], dtype=np.float32))
print('nd_tensor', id(nd_tensor), nd_tensor.shape, nd_tensor.dtype)
cp_tensor = Tensor(nd_tensor)
print('cp_tensor', id(cp_tensor), cp_tensor.shape, cp_tensor.dtype)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;int_tensor ;value is : 1 ;shape is : () ;dtype is : Int64
float_tensor ;value is : 1.0 ;shape is : () ;dtype is : Float32
bool_tensor ;value is : True ;shape is : () ;dtype is : Bool
tuple_tensor ;value is : [1 2] ;shape is : (2,) ;dtype is : Int64
list_tensor ;value is : [1 3] ;shape is : (2,) ;dtype is : Int64
complex_tensor ;value is : (1+9j) ;shape is : () ;dtype is : Complex128
nd_tensor 281468910652768 (2, 2) Float32
cp_tensor 281468910653168 (2, 2) Float32
&lt;/code&gt;&lt;/pre&gt;
&lt;ol start="2"&gt;
&lt;li&gt;ä½¿ç”¨initåˆå§‹åŒ–å™¨æ„é€ å¼ é‡&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å½“ä½¿ç”¨initåˆå§‹åŒ–å™¨å¯¹å¼ é‡è¿›è¡Œåˆå§‹åŒ–æ—¶ï¼Œæ”¯æŒä¼ å…¥çš„å‚æ•°æœ‰initã€shapeã€dtypeã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;init: æ”¯æŒä¼ å…¥initializerçš„å­ç±»ã€‚å¦‚ï¼šä¸‹æ–¹ç¤ºä¾‹ä¸­çš„ One() å’Œ Normal()ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;shape: æ”¯æŒä¼ å…¥ listã€tupleã€ intã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;dtype: æ”¯æŒä¼ å…¥mindspore.dtypeã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code class="language-python"&gt;from mindspore.common.initializer import One, Normal

# Initialize a tensor with ones
tensor1 = mindspore.Tensor(shape=(2, 2), dtype=mindspore.float32, init=One())
print(&amp;quot;tensor1:\n&amp;quot;, tensor1)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;tensor1:
 [[1. 1.]
 [1. 1.]]
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Normalåˆå§‹åŒ–å™¨ä¼šå°†æ•°æ®è¿›è¡Œæ­£å¤ªåˆ†å¸ƒå¤„ç†ï¼Œå…¬å¼å¦‚ä¸‹:
$f(x) =  \frac{1} {\sqrt{2&lt;em&gt;Ï€} * sigma}exp(-\frac{(x - mean)^2} {2&lt;/em&gt;{sigma}^2})$
å‚æ•°é»˜è®¤å€¼ sigma=0.01, mean=0.0ï¼Œç”Ÿæˆçš„xå…ƒç´ ä¸ºéšæœºå€¼&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-python"&gt;# Initialize a tensor from normal distribution
tensor2 = mindspore.Tensor(shape=(2, 3), dtype=mindspore.float32, init=Normal())
print(&amp;quot;tensor2:\n&amp;quot;, tensor2)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;tensor2:
 [[ 0.01408593  0.00398565  0.01824992]
 [-0.00208053  0.01520424  0.01576259]]
&lt;/code&gt;&lt;/pre&gt;
&lt;blockquote&gt;
&lt;p&gt;åœ¨æˆ‘æ¢ç©¶Normal()ä½œç”¨æ—¶ï¼Œæ³¨æ„åˆ°å¦ä¸€ä¸ªå’Œ &lt;code&gt;mindspore.Tensor&lt;/code&gt; ç±»ä¼¼çš„ç±» &lt;code&gt;mindspore._c_expression.Tensor&lt;/code&gt;,é‚£ä¹ˆä»–ä»¬æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ç¼–å†™äº†ä»¥ä¸‹pythonä»£ç éªŒè¯ï¼š&lt;/p&gt;
&lt;/blockquote&gt;
&lt;pre&gt;&lt;code class="language-python"&gt;from mindspore._c_expression import Tensor as Tensor_
import mindspore._c_expression as _c
# è¿™ä¸ª_c_expressionæ˜¯ä¸€ä¸ªsoåº“æ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡__file__å±æ€§æŸ¥çœ‹å…¶æ‰€åœ¨ä½ç½®
print('the _c_expression so library file path is :', _c.__file__)
some_list = []  # è®°è½½Tensor_å’ŒTensorè‡ªèº«å±æ€§åœ°å€ç›¸åŒéƒ¨åˆ†
diff_list = []
for k in dir(Tensor_):
    if k.startswith('__'): continue
    if id(getattr(Tensor_, k)) == id(getattr(Tensor,k)):
        some_list.append(k)
    else:
        diff_list.append(k)
print('-' * 20)
print('mindspore.Tensor and mindspore._c_expression.Tensor has some attrs is :',
      ' '.join(some_list))
print('all some attrs nums is :', len(some_list))
print('-' * 20)
print('mindspore.Tensor and mindspore._c_expression.Tensor has diff attrs is :',
       ' '.join(diff_list))
print('all diff attrs nums is :', len(diff_list))
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;the _c_expression so library file path is : /home/nginx/miniconda/envs/jupyter/lib/python3.9/site-packages/mindspore/_c_expression.cpython-39-aarch64-linux-gnu.so
--------------------
mindspore.Tensor and mindspore._c_expression.Tensor has some attrs is : _dtype _flatten_tensors _flush_from_cache _get_flattened_tensors _get_fusion_size _is_flattened _is_test_stub _itemsize _nbytes _shape _size _strides adapter_flag assign_value_cpp data_sync dim getitem_index_info init_flag is_init offload offload_file_path param_info persistent_data_from_numpy set_cast_dtype set_dtype set_init_flag setitem_index_info
all some attrs nums is : 27
--------------------
mindspore.Tensor and mindspore._c_expression.Tensor has diff attrs is : _offload asnumpy asnumpy_of_slice_persistent_data contiguous dtype from_numpy get_bytes is_contiguous is_persistent_data shape
all diff attrs nums is : 10
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å¯ä»¥çœ‹åˆ°Tensor_å’ŒTensorå¤§éƒ¨åˆ†å±æ€§çš„å‡æŒ‡å‘åŒä¸€åœ°å€ï¼Œå› ä¸º_c_expressionæ˜¯ä¸€ä¸ªåº“æ‰©å±•æ¨¡å—ï¼Œè¦æƒ³æ›´åŠ è¯¦ç»†çš„äº†è§£ä»–ä»¬ä¹‹é—´åŒºåˆ«ï¼Œéœ€è¦å»æŸ¥çœ‹å¯¹åº”çš„c++æºç å®ç°ã€‚
è¿™é‡Œåªåˆ—å‡ºéƒ¨åˆ†æˆ‘æ¢ç©¶çš„å†…å®¹ï¼Œæ›´è¯¦ç»†çš„è§£æè¯·è‡ªè¡ŒæŸ¥çœ‹æºç ã€‚&lt;/p&gt;
&lt;!-- TODO æœªå®Œæˆï¼Œä»…åˆ—å‡ºéƒ¨åˆ†ä»¥è®°å½• --&gt;
&lt;ol&gt;
&lt;li&gt;pythonç±»Tensorçš„initæ–¹æ³•åœ¨&lt;code&gt;mindspore\python\mindspore\common\tensor.py&lt;/code&gt;;åœ¨å…¶åˆå§‹åŒ–æ–¹æ³•ä¸­æœ€ç»ˆå‡ä¼šè°ƒç”¨&lt;code&gt;Tensor_.__init__&lt;/code&gt;æ–¹æ³•&lt;/li&gt;
&lt;li&gt;mindsporeç¼–å†™pythonæ‰©å±•&lt;code&gt;_c_expression&lt;/code&gt;æ˜¯é€šè¿‡&lt;code&gt;pybind11&lt;/code&gt;è¿›è¡Œçš„ï¼Œåœ¨&lt;code&gt;mindspore\ccsrc\CMakeLists.txt&lt;/code&gt;æ–‡ä»¶ä¸­å­˜åœ¨è°ƒç”¨&lt;code&gt;pybind11_add_module&lt;/code&gt;çš„cmakeå®è¿›è¡Œpyæ¨¡å—ç»‘å®šï¼Œå¯¹åº”æ–‡ä»¶ä¸º&lt;code&gt;mindspore\ccsrc\pipeline\jit\ps\init.cc&lt;/code&gt;ï¼Œå†…æœ‰&lt;code&gt;PYBIND11_MODULE(_c_expression, m)&lt;/code&gt; è¿›è¡Œ&lt;code&gt;_c_expression&lt;/code&gt;æ¨¡å—çš„å…·ä½“ä»£ç ç»‘å®šã€‚&lt;/li&gt;
&lt;li&gt;ç¬¬2æ­¥ä¸­ï¼Œ&lt;code&gt;_c_expression&lt;/code&gt;æ¨¡å—ç¼ºå°‘py::class Tensorçš„ç»‘å®šï¼Œæˆ‘åªåœ¨&lt;code&gt;mindspore\ccsrc\pybind_api\ir\tensor_py.cc&lt;/code&gt;ä¸­æ‰¾åˆ° &lt;code&gt;mindspore.Tensor&lt;/code&gt; çš„ç»‘å®šä»£ç ã€‚&lt;/li&gt;
&lt;li&gt;è¿›ä¸€æ­¥ç ”ç©¶å‘ç°ï¼Œ&lt;code&gt;tensor_py.cc&lt;/code&gt;å¯¹åº”çš„&lt;code&gt;py::class Tensor&lt;/code&gt;ç»‘å®šä»£ç åœ¨å‡½æ•°&lt;code&gt;RegMetaTensor&lt;/code&gt;ä¸­ï¼Œä¼šè¢«&lt;code&gt;RegModule&lt;/code&gt;è°ƒç”¨ï¼Œæœ€ç»ˆåœ¨&lt;code&gt;PYBIND11_MODULE&lt;/code&gt;ä¸­é€šè¿‡&lt;code&gt;mindspore::RegModuleHelper&lt;/code&gt;è°ƒç”¨ç»‘å®šï¼Œè€Œ&lt;code&gt;mindspore.Tensor&lt;/code&gt;ç»§æ‰¿è‡ª&lt;code&gt;_c_expression.Tensor&lt;/code&gt;ç±»ï¼Œå¯ä»¥é€šè¿‡ç±»çš„mroæ–¹æ³•æŸ¥çœ‹ç»§æ‰¿å…³ç³»ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code class="language-python"&gt;print(Tensor.mro())
print(Tensor_.mro())
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;[&amp;lt;class 'mindspore.common.tensor.Tensor'&amp;gt;, &amp;lt;class 'mindspore._c_expression.Tensor'&amp;gt;, &amp;lt;class 'mindspore._c_expression.MetaTensor'&amp;gt;, &amp;lt;class 'pybind11_builtins.pybind11_object'&amp;gt;, &amp;lt;class 'object'&amp;gt;]
[&amp;lt;class 'mindspore._c_expression.Tensor'&amp;gt;, &amp;lt;class 'mindspore._c_expression.MetaTensor'&amp;gt;, &amp;lt;class 'pybind11_builtins.pybind11_object'&amp;gt;, &amp;lt;class 'object'&amp;gt;]
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class="language-python"&gt;# å›åˆ°æ­£é¢˜ï¼Œå¼ é‡Tensorçš„åˆ›å»ºä¹Ÿå¯ä»¥æ ¹æ®å¦ä¸€ä¸ªTensorçš„å±æ€§è¿›è¡Œ
# mindsporeæä¾›äº†ä¸€ä¸ªopsæ¨¡å—å¯ç”¨äºCellçš„æ„é€ 
a_ones = ops.ones_like(tensor1)
a_zeros = ops.zeros_like(tensor1)
print('ops create ones tensor is:', a_ones)
print('ops create zeros tensor is:', a_zeros)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;ops create ones tensor is: [[1. 1.]
 [1. 1.]]
ops create zeros tensor is: [[0. 0.]
 [0. 0.]]
&lt;/code&gt;&lt;/pre&gt;
&lt;h3&gt;å¼ é‡çš„å¸¸ç”¨å±æ€§&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å½¢çŠ¶ï¼ˆshapeï¼‰ï¼š&lt;code&gt;Tensor&lt;/code&gt;çš„shapeï¼Œæ˜¯ä¸€ä¸ªtupleã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ•°æ®ç±»å‹ï¼ˆdtypeï¼‰ï¼š&lt;code&gt;Tensor&lt;/code&gt;å…ƒç´ çš„dtypeï¼Œæ˜¯MindSporeçš„ä¸€ä¸ªæ•°æ®ç±»å‹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å•ä¸ªå…ƒç´ å¤§å°ï¼ˆitemsizeï¼‰ï¼š &lt;code&gt;Tensor&lt;/code&gt;ä¸­æ¯ä¸€ä¸ªå…ƒç´ å ç”¨å­—èŠ‚æ•°ï¼Œæ˜¯ä¸€ä¸ªæ•´æ•°ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å ç”¨å­—èŠ‚æ•°é‡ï¼ˆnbytesï¼‰ï¼š &lt;code&gt;Tensor&lt;/code&gt;å ç”¨çš„æ€»å­—èŠ‚æ•°ï¼Œæ˜¯ä¸€ä¸ªæ•´æ•°ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç»´æ•°ï¼ˆndimï¼‰ï¼š &lt;code&gt;Tensor&lt;/code&gt;çš„ç§©ï¼Œä¹Ÿå°±æ˜¯len(tensor.shape)ï¼Œæ˜¯ä¸€ä¸ªæ•´æ•°ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å…ƒç´ ä¸ªæ•°ï¼ˆsizeï¼‰ï¼š &lt;code&gt;Tensor&lt;/code&gt;ä¸­æ‰€æœ‰å…ƒç´ çš„ä¸ªæ•°ï¼Œæ˜¯ä¸€ä¸ªæ•´æ•°ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ¯ä¸€ç»´æ­¥é•¿ï¼ˆstridesï¼‰ï¼š &lt;code&gt;Tensor&lt;/code&gt;æ¯ä¸€ç»´æ‰€éœ€è¦çš„å­—èŠ‚æ•°ï¼Œæ˜¯ä¸€ä¸ªtupleã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code class="language-python"&gt;t = Tensor([[1,2,3],[1,7,9]])
print(&amp;quot;t_shape:&amp;quot;, t.shape)
print(&amp;quot;t_dtype:&amp;quot;, t.dtype)
print(&amp;quot;t_itemsize:&amp;quot;, t.itemsize)
print(&amp;quot;t_nbytes:&amp;quot;, t.nbytes)
print(&amp;quot;t_ndim:&amp;quot;, t.ndim)
print(&amp;quot;t_size:&amp;quot;, t.size)
print(&amp;quot;t_strides:&amp;quot;, t.strides)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;t_shape: (2, 3)
t_dtype: Int64
t_itemsize: 8
t_nbytes: 48
t_ndim: 2
t_size: 6
t_strides: (24, 8)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;span display=hidden&gt;### ç»´åº¦ä¸ç»´æ•°åŒºåˆ«
Tensorflowæè¿°å¼ é‡çš„ç»´åº¦ï¼šé˜¶ï¼Œå½¢çŠ¶ä»¥åŠç»´æ•°&lt;/p&gt;
&lt;p&gt;TensorFlowç”¨å¼ é‡è¿™ç§æ•°æ®ç»“æ„æ¥è¡¨ç¤ºæ‰€æœ‰çš„æ•°æ®.ä½ å¯ä»¥æŠŠä¸€ä¸ªå¼ é‡æƒ³è±¡æˆä¸€ä¸ªnç»´çš„æ•°ç»„æˆ–åˆ—è¡¨.ä¸€ä¸ªå¼ é‡æœ‰ä¸€ä¸ªé™æ€ç±»å‹å’ŒåŠ¨æ€ç±»å‹çš„ç»´æ•°.å¼ é‡å¯ä»¥åœ¨å›¾ä¸­çš„èŠ‚ç‚¹ä¹‹é—´æµé€šã€‚&lt;/p&gt;
&lt;p&gt;åœ¨TensorFlowç³»ç»Ÿä¸­ï¼Œå¼ é‡çš„ç»´æ•°æ¥è¢«æè¿°ä¸ºé˜¶ã€‚ä½†æ˜¯å¼ é‡çš„é˜¶å’ŒçŸ©é˜µçš„é˜¶å¹¶ä¸æ˜¯åŒä¸€ä¸ªæ¦‚å¿µã€‚å¼ é‡çš„é˜¶ï¼ˆæœ‰æ—¶æ˜¯å…³äºå¦‚é¡ºåºæˆ–åº¦æ•°æˆ–è€…æ˜¯nç»´ï¼‰æ˜¯å¼ é‡ç»´æ•°çš„ä¸€ä¸ªæ•°é‡æè¿°ã€‚&lt;/p&gt;
&lt;p&gt;æ¯”å¦‚ï¼Œä¸‹é¢çš„å¼ é‡ï¼ˆä½¿ç”¨Pythonä¸­listå®šä¹‰çš„ï¼‰å°±æ˜¯2é˜¶ã€‚&lt;/p&gt;
&lt;p&gt;TensorFlowæ–‡æ¡£ä¸­ä½¿ç”¨äº†ä¸‰ç§è®°å·æ¥æ–¹ä¾¿åœ°æè¿°å¼ é‡çš„ç»´åº¦ï¼šé˜¶ï¼Œå½¢çŠ¶ä»¥åŠç»´æ•°.ä¸‹è¡¨å±•ç¤ºäº†ä»–ä»¬ä¹‹é—´çš„å…³ç³»ï¼š
&lt;/span&gt;&lt;/p&gt;
&lt;h3&gt;å¼ é‡ç´¢å¼•&lt;/h3&gt;
&lt;p&gt;Tensorç´¢å¼•ä¸Numpyç´¢å¼•ç±»ä¼¼ï¼Œç´¢å¼•ä»0å¼€å§‹ç¼–åˆ¶ï¼Œè´Ÿç´¢å¼•è¡¨ç¤ºæŒ‰å€’åºç¼–åˆ¶ï¼Œå†’å·:å’Œ ...ç”¨äºå¯¹æ•°æ®è¿›è¡Œåˆ‡ç‰‡ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-python"&gt;print('the tensor is:', t)
print(&amp;quot;First row: {}&amp;quot;.format(t[0]))
print(&amp;quot;value of bottom right corner: {}&amp;quot;.format(t[1, 1]))
print(&amp;quot;Last column: {}&amp;quot;.format(t[:, -1]))
print(&amp;quot;First column: {}&amp;quot;.format(t[..., 0]))
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;the tensor is: [[1 2 3]
 [1 7 9]]
First row: [1 2 3]
value of bottom right corner: 7
Last column: [3 9]
First column: [1 1]
&lt;/code&gt;&lt;/pre&gt;
&lt;h3&gt;å¼ é‡è¿ç®—&lt;/h3&gt;
&lt;p&gt;å¼ é‡ä¹‹é—´å¯ä»¥ä½¿ç”¨å¾ˆå¤šè¿ç®—ï¼ŒåŒ…æ‹¬ç®—æœ¯ã€çº¿æ€§ä»£æ•°ã€çŸ©é˜µå¤„ç†ï¼ˆè½¬ç½®ã€æ ‡å¼•ã€åˆ‡ç‰‡ï¼‰ã€é‡‡æ ·ç­‰ï¼Œä½¿ç”¨æ–¹æ³•å’Œnumpyç±»ä¼¼&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-python"&gt;x = Tensor(np.array([9, 2, 3, 5]), mindspore.float32)
y = Tensor(np.array([4, 5, 6, 3]), mindspore.float32)
# 1. ç®—æœ¯è¿ç®—
print(&amp;quot;add:&amp;quot;, x + y)
print(&amp;quot;sub:&amp;quot;, x - y)
print(&amp;quot;mul:&amp;quot;, x * y)
print(&amp;quot;div:&amp;quot;, x / y)
print(&amp;quot;mod:&amp;quot;, x % y)
print(&amp;quot;floordiv:&amp;quot;, x // y)
# 2. çŸ©é˜µå¤„ç†
print(&amp;quot;è½¬ç½®:&amp;quot;, x.reshape((2,2)).T)
# ä½¿ç”¨`ops.concat`è¿æ¥å¼ é‡
print(&amp;quot;concat tensors:&amp;quot;, ops.concat((x, y), axis=0))
# ä½¿ç”¨ops.stackä»æ–°ç»´åº¦åˆå¹¶å¼ é‡
print(&amp;quot;stack tensors:&amp;quot;, ops.stack([x,y]))
# 3. tensorä¸np.ndarrayè½¬æ¢
print(f&amp;quot;x: {x}&amp;quot;, type(x))
n = x.asnumpy()
print(f&amp;quot;n: {n}&amp;quot;, type(n))

&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;add: [13.  7.  9.  8.]
sub: [ 5. -3. -3.  2.]
mul: [36. 10. 18. 15.]
div: [2.25      0.4       0.5       1.6666666]
mod: [1. 2. 3. 2.]
floordiv: [2. 0. 0. 1.]
[[9. 3.]
 [2. 5.]]
concat tensors: [9. 2. 3. 5. 4. 5. 6. 3.]
stack tensors: [[9. 2. 3. 5.]
 [4. 5. 6. 3.]]
x: [9. 2. 3. 5.] &amp;lt;class 'mindspore.common.tensor.Tensor'&amp;gt;
n: [9. 2. 3. 5.] &amp;lt;class 'numpy.ndarray'&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;h3&gt;å‡ ç§ç‰¹æ®Štensor&lt;/h3&gt;
&lt;h4&gt;ç¨€ç–å¼ é‡&lt;/h4&gt;
&lt;p&gt;ç¨€ç–å¼ é‡ä¸­ç»å¤§éƒ¨åˆ†å…ƒç´ çš„å€¼ä¸ºé›¶ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨æŸäº›åº”ç”¨åœºæ™¯ä¸­ï¼ˆæ¯”å¦‚æ¨èç³»ç»Ÿã€åˆ†å­åŠ¨åŠ›å­¦ã€å›¾ç¥ç»ç½‘ç»œç­‰ï¼‰ï¼Œæ•°æ®çš„ç‰¹å¾æ˜¯ç¨€ç–çš„ï¼Œè‹¥ä½¿ç”¨æ™®é€šå¼ é‡è¡¨å¾è¿™äº›æ•°æ®ä¼šå¼•å…¥å¤§é‡ä¸å¿…è¦çš„è®¡ç®—ã€å­˜å‚¨å’Œé€šè®¯å¼€é”€ã€‚è¿™æ—¶å°±å¯ä»¥ä½¿ç”¨ç¨€ç–å¼ é‡æ¥è¡¨å¾è¿™äº›æ•°æ®ã€‚&lt;/p&gt;
&lt;p&gt;MindSporeæ”¯æŒå¸¸ç”¨çš„&lt;code&gt;CSR&lt;/code&gt;å’Œ&lt;code&gt;COO&lt;/code&gt;ä¸¤ç§ç¨€ç–æ•°æ®æ ¼å¼ï¼Œå¦‚&lt;code&gt;CSRTensor&lt;/code&gt;ã€&lt;code&gt;COOTensor&lt;/code&gt;å’Œ&lt;code&gt;RowTensor&lt;/code&gt;ç­‰&lt;/p&gt;
&lt;p&gt;å¸¸ç”¨ç¨€ç–å¼ é‡çš„è¡¨è¾¾å½¢å¼æ˜¯&lt;code&gt;&amp;lt;indices:Tensor, values:Tensor, shape:Tensor&amp;gt;&lt;/code&gt;ã€‚å…¶ä¸­ï¼Œ&lt;code&gt;indices&lt;/code&gt;è¡¨ç¤ºéé›¶ä¸‹æ ‡å…ƒç´ ï¼Œ &lt;code&gt;values&lt;/code&gt;è¡¨ç¤ºéé›¶å…ƒç´ çš„å€¼ï¼Œshapeè¡¨ç¤ºçš„æ˜¯è¢«å‹ç¼©çš„ç¨€ç–å¼ é‡çš„å½¢çŠ¶ã€‚&lt;/p&gt;
&lt;h5&gt;CSRTensor&lt;/h5&gt;
&lt;p&gt;&lt;code&gt;CSR&lt;/code&gt;ï¼ˆCompressed Sparse Rowï¼Œå‹ç¼©ç¨€ç–è¡Œï¼‰ç¨€ç–å¼ é‡æ ¼å¼æœ‰ç€é«˜æ•ˆçš„å­˜å‚¨ä¸è®¡ç®—çš„ä¼˜åŠ¿ã€‚å…¶ä¸­ï¼Œéé›¶å…ƒç´ çš„å€¼å­˜å‚¨åœ¨&lt;code&gt;values&lt;/code&gt;ä¸­ï¼Œéé›¶å…ƒç´ çš„ä½ç½®å­˜å‚¨åœ¨&lt;code&gt;indptr&lt;/code&gt;ï¼ˆè¡Œï¼‰å’Œ&lt;code&gt;indices&lt;/code&gt;ï¼ˆåˆ—ï¼‰ä¸­ã€‚å„å‚æ•°å«ä¹‰å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;indptr&lt;/code&gt;: ä¸€ç»´æ•´æ•°å¼ é‡, è¡¨ç¤ºç¨€ç–æ•°æ®æ¯ä¸€è¡Œçš„éé›¶å…ƒç´ åœ¨&lt;code&gt;values&lt;/code&gt;ä¸­çš„èµ·å§‹ä½ç½®å’Œç»ˆæ­¢ä½ç½®, ç´¢å¼•æ•°æ®ç±»å‹æ”¯æŒint16ã€int32ã€int64ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;indices&lt;/code&gt;: ä¸€ç»´æ•´æ•°å¼ é‡ï¼Œè¡¨ç¤ºç¨€ç–å¼ é‡éé›¶å…ƒç´ åœ¨åˆ—ä¸­çš„ä½ç½®, ä¸&lt;code&gt;values&lt;/code&gt;é•¿åº¦ç›¸ç­‰ï¼Œç´¢å¼•æ•°æ®ç±»å‹æ”¯æŒint16ã€int32ã€int64ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;values&lt;/code&gt;: ä¸€ç»´å¼ é‡ï¼Œè¡¨ç¤º&lt;code&gt;CSRTensor&lt;/code&gt;ç›¸å¯¹åº”çš„éé›¶å…ƒç´ çš„å€¼ï¼Œä¸&lt;code&gt;indices&lt;/code&gt;é•¿åº¦ç›¸ç­‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;shape&lt;/code&gt;: è¡¨ç¤ºè¢«å‹ç¼©çš„ç¨€ç–å¼ é‡çš„å½¢çŠ¶ï¼Œæ•°æ®ç±»å‹ä¸º&lt;code&gt;Tuple&lt;/code&gt;ï¼Œç›®å‰ä»…æ”¯æŒäºŒç»´&lt;code&gt;CSRTensor&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;æ³¨æ„&lt;/strong&gt; CSRTensoræœ‰ä»¥ä¸‹é™åˆ¶ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;CSRä»…èƒ½è¡¨ç¤ºäºŒç»´å¼ é‡&lt;/li&gt;
&lt;li&gt;è¡Œå¼ é‡&lt;code&gt;indptr&lt;/code&gt;çš„&lt;code&gt;size&lt;/code&gt;ä¸º&lt;code&gt;csrtensor.shape[0]+1&lt;/code&gt;ï¼Œå…¶ç´¢å¼•iè¡¨ç¤ºcsrå¼ é‡ç¬¬iè¡Œï¼Œå€¼ä¸ºåˆ—å¼ é‡&lt;code&gt;indices&lt;/code&gt;ç´¢å¼•ï¼Œå³æŒ‡å‘è¯¥è¡Œç¬¬ä¸€ä¸ªé0å…ƒç´ åˆ—ä½ç½®&lt;/li&gt;
&lt;li&gt;åˆ—å¼ é‡&lt;code&gt;indices&lt;/code&gt;ï¼Œå­˜å‚¨æ¯ä¸ªé0å…ƒç´ çš„åˆ—ä½ç½®ï¼Œé•¿åº¦ä¸å€¼å¼ é‡&lt;code&gt;values&lt;/code&gt;ç›¸ç­‰ï¼Œ&lt;code&gt;indices[i]&lt;/code&gt; è¡¨ç¤ºç¬¬iä¸ªé0å…ƒç´ æ‰€åœ¨åˆ—ä½ç½®&lt;/li&gt;
&lt;li&gt;å€¼å¼ é‡&lt;code&gt;values&lt;/code&gt; å­˜å‚¨csræ‰€æœ‰é0å€¼ï¼ŒæŒ‰å…ˆè¡Œååˆ—æ’åº&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;æ³¨æ„&lt;/strong&gt; åœ¨Ascendå¹³å°ï¼ŒCSRTensorå¾ˆå¤šè¿ç®—ä¸å¯ç”¨&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-python"&gt;indptr = Tensor([0, 2, 4], dtype=mindspore.int32)
indices = Tensor([0, 2, 1, 3], dtype=mindspore.int32)
values = Tensor([1, 5, 2, 9], dtype=mindspore.float32)
shape = (2, 4)

# Make a CSRTensor
csr_tensor = CSRTensor(indptr, indices, values, shape)

print(csr_tensor.astype(mindspore.float64).dtype)
print(csr_tensor)
# ç¬¬ä¸€è¡Œå…ƒç´ indptr[0]é¦–ä¸ªéé›¶å…ƒç´ åœ¨indices[indptr[0]]åˆ—å‡ºç°ï¼Œå€¼ä¸ºvalues[indptr[0]]
# ç¬¬äºŒè¡Œå…ƒç´ indptr[1]é¦–ä¸ªéé›¶å…ƒç´ åœ¨indices[indptr[1]]åˆ—å‡ºç°ï¼Œå€¼ä¸ºvalues[indptr[1]]
# values[indptr[0],indptr[1]]ä¸ºç¬¬ä¸€è¡Œæ‰€æœ‰éé›¶å…ƒç´ ï¼Œåˆ—ä½ç½®åœ¨indicesä¸­
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;Float64
CSRTensor(shape=[2, 4], dtype=Float32, indptr=Tensor(shape=[3], dtype=Int32, value=[0 1 2]), indices=Tensor(shape=[4], dtype=Int32, value=[0 2 1 3]), values=Tensor(shape=[4], dtype=Float32, value=[ 1.00000000e+00  5.00000000e+00  2.00000000e+00  9.00000000e+00]))
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ä¸Šè¿°ä»£ç è¡¨ç¤ºå¦‚ä¸‹æ‰€ç¤ºçš„&lt;code&gt;CSRTensor&lt;/code&gt;:&lt;/p&gt;
&lt;p&gt;$$
\left[
\begin{matrix}
1 &amp;amp; 0 &amp;amp; 5 &amp;amp; 0 \
0 &amp;amp; 2 &amp;amp; 0 &amp;amp; 9
\end{matrix}
\right]
$$&lt;/p&gt;
&lt;h5&gt;COOTensor&lt;/h5&gt;
&lt;p&gt;&lt;code&gt;COO&lt;/code&gt;ï¼ˆCoordinate Formatï¼‰ç¨€ç–å¼ é‡æ ¼å¼ç”¨æ¥è¡¨ç¤ºæŸä¸€å¼ é‡åœ¨ç»™å®šç´¢å¼•ä¸Šéé›¶å…ƒç´ çš„é›†åˆï¼Œè‹¥éé›¶å…ƒç´ çš„ä¸ªæ•°ä¸º&lt;code&gt;N&lt;/code&gt;ï¼Œè¢«å‹ç¼©çš„å¼ é‡çš„ç»´æ•°ä¸º&lt;code&gt;ndims&lt;/code&gt;ã€‚å„å‚æ•°å«ä¹‰å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;indices&lt;/code&gt;: äºŒç»´æ•´æ•°å¼ é‡ï¼Œæ¯è¡Œä»£è¡¨éé›¶å…ƒç´ ä¸‹æ ‡ã€‚å½¢çŠ¶ï¼š&lt;code&gt;[N, ndims]&lt;/code&gt;ï¼Œ ç´¢å¼•æ•°æ®ç±»å‹æ”¯æŒint16ã€int32ã€int64ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;values&lt;/code&gt;: ä¸€ç»´å¼ é‡ï¼Œè¡¨ç¤ºç›¸å¯¹åº”çš„éé›¶å…ƒç´ çš„å€¼ã€‚å½¢çŠ¶ï¼š&lt;code&gt;[N]&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;shape&lt;/code&gt;: è¡¨ç¤ºè¢«å‹ç¼©çš„ç¨€ç–å¼ é‡çš„å½¢çŠ¶ï¼Œç›®å‰ä»…æ”¯æŒäºŒç»´&lt;code&gt;COOTensor&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;æ³¨æ„&lt;/strong&gt; valuesä¸­æ¯ä¸ªéé›¶å…ƒç´ values[i]åœ¨COOTensorä¸­çš„åæ ‡ä¸ºindices[i]ï¼Œå› æ­¤å¯æ”¯æŒå¤šç»´Tensor&lt;/p&gt;
&lt;p&gt;ä¸‹é¢ç»™å‡ºä¸€äº›COOTensorçš„ä½¿ç”¨ç¤ºä¾‹ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-python"&gt;indices = Tensor([[0, 1], [1, 2]], dtype=mindspore.int32)
values = Tensor([1, 2], dtype=mindspore.float32)
shape = (3, 4)

# Make a COOTensor
COOTensor(indices, values, shape)

&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;COOTensor(shape=[3, 4], dtype=Float32, indices=Tensor(shape=[2, 2], dtype=Int32, value=
[[0 1]
 [1 2]]), values=Tensor(shape=[2], dtype=Float32, value=[ 1.00000000e+00  2.00000000e+00]))
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ä¸Šè¿°ä»£ç è¡¨ç¤ºå¦‚ä¸‹æ‰€ç¤ºçš„&lt;code&gt;COOTensor&lt;/code&gt;:&lt;/p&gt;
&lt;p&gt;$$
\left[
\begin{matrix}
0 &amp;amp; 1 &amp;amp; 0 &amp;amp; 0 \
0 &amp;amp; 0 &amp;amp; 2 &amp;amp; 0 \
0 &amp;amp; 0 &amp;amp; 0 &amp;amp; 0
\end{matrix}
\right]
$$&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-python"&gt;from datetime import datetime
import pytz
print(datetime.now(pytz.timezone('Asia/Shanghai')), '\nuser:YZSH-HSZY')
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;2024-07-04 16:08:16.273507+08:00 
user:YZSH-HSZY
&lt;/code&gt;&lt;/pre&gt;
</content><category term="Mindspore"/></entry><entry><title>MindSpore Learen Notes -- QuikStart.</title><link href="https://yzsh-hszy.github.io/2024-07-01-mindspore-learen-notes-quikstart.html" rel="alternate"/><published>2024-07-01T12:00:00+08:00</published><updated>2024-07-01T12:00:00+08:00</updated><author><name>YZSH-HSZY</name></author><id>tag:yzsh-hszy.github.io,2024-07-01:/2024-07-01-mindspore-learen-notes-quikstart.html</id><summary type="html">&lt;h1&gt;mindsporeä»‹ç»&lt;/h1&gt;
&lt;p&gt;æ˜‡æ€MindSporeæ˜¯ä¸€ä¸ªå…¨åœºæ™¯æ·±åº¦å­¦ä¹ æ¡†æ¶ï¼Œæ—¨åœ¨å®ç°æ˜“å¼€å‘ã€é«˜æ•ˆæ‰§è¡Œã€å…¨åœºæ™¯ç»Ÿä¸€éƒ¨ç½²ä¸‰å¤§ç›®æ ‡ã€‚
æ˜‡æ€æä¾›ä¸€ç³»åˆ—é…å¥—è®¾æ–½èƒ½å¤Ÿä¸ºç®€åŒ–æ·±åº¦å­¦ä¹ è¿‡ç¨‹ï¼Œå¹¶æ â€¦&lt;/p&gt;</summary><content type="html">&lt;h1&gt;mindsporeä»‹ç»&lt;/h1&gt;
&lt;p&gt;æ˜‡æ€MindSporeæ˜¯ä¸€ä¸ªå…¨åœºæ™¯æ·±åº¦å­¦ä¹ æ¡†æ¶ï¼Œæ—¨åœ¨å®ç°æ˜“å¼€å‘ã€é«˜æ•ˆæ‰§è¡Œã€å…¨åœºæ™¯ç»Ÿä¸€éƒ¨ç½²ä¸‰å¤§ç›®æ ‡ã€‚
æ˜‡æ€æä¾›ä¸€ç³»åˆ—é…å¥—è®¾æ–½èƒ½å¤Ÿä¸ºç®€åŒ–æ·±åº¦å­¦ä¹ è¿‡ç¨‹ï¼Œå¹¶æä¾›ä¸€äº›å·¥å…·ç”¨äºè¾…åŠ©å¼€å‘AIé¡¹ç›®ã€‚&lt;/p&gt;
&lt;h2&gt;mindsporeåè¯è§£é‡Š&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;shuffle(æ¸…æ´—)
æ•°æ®é›†éšæœºshuffleå¯ä»¥æ¶ˆé™¤æ•°æ®æ’åˆ—é€ æˆçš„åˆ†å¸ƒä¸å‡é—®é¢˜ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;map(æ˜ å°„ï¼Œä¸€èˆ¬ç”¨äºå˜æ¢)
mapæ“ä½œæ˜¯æ•°æ®é¢„å¤„ç†çš„å…³é”®æ“ä½œï¼Œå¯ä»¥é’ˆå¯¹æ•°æ®é›†æŒ‡å®šåˆ—ï¼ˆcolumnï¼‰æ·»åŠ æ•°æ®å˜æ¢ï¼ˆTransformsï¼‰ï¼Œå°†æ•°æ®å˜æ¢åº”ç”¨äºè¯¥åˆ—æ•°æ®çš„æ¯ä¸ªå…ƒç´ ï¼Œå¹¶è¿”å›åŒ…å«å˜æ¢åå…ƒç´ çš„æ–°æ•°æ®é›†ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;batch(æ‰¹å¤§å°,ç»Ÿä¸€æ‰¹æ“ä½œæ—¶æ•°æ®ä¿æŒç›¸åŒå½¢çŠ¶)
å°†æ•°æ®é›†æ‰“åŒ…ä¸ºå›ºå®šå¤§å°çš„batchæ˜¯åœ¨æœ‰é™ç¡¬ä»¶èµ„æºä¸‹ä½¿ç”¨æ¢¯åº¦ä¸‹é™è¿›è¡Œæ¨¡å‹ä¼˜åŒ–çš„æŠ˜ä¸­æ–¹æ³•ï¼Œå¯ä»¥ä¿è¯æ¢¯åº¦ä¸‹é™çš„éšæœºæ€§å’Œä¼˜åŒ–è®¡ç®—é‡ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;è®¾ç½®batchåï¼Œåœ¨éšåçš„æ•°æ®é›†æ¯ä¸€æ¬¡è¿­ä»£è·å–æ•°æ®æ—¶ï¼Œè¿”å›ä¸€ä¸ªbatchå¤§å°çš„æ‰¹æ•°æ®ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;è‡ªå®šä¹‰æ•°æ®é›†
mindspore.dataset æ¨¡å—æä¾›äº†ä¸€äº›å¸¸ç”¨çš„å…¬å¼€æ•°æ®é›†(å…¬å¼€æ•°æ®é›†è¯·ä½¿ç”¨downloadä¸‹è½½ï¼Œdatasetåªèƒ½åŠ è½½æœ¬åœ°æ•°æ®é›†)å’Œæ ‡å‡†æ ¼å¼æ•°æ®é›†çš„åŠ è½½APIã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¯¹äºMindSporeæš‚ä¸æ”¯æŒç›´æ¥åŠ è½½çš„æ•°æ®é›†ï¼Œå¯ä»¥æ„é€ è‡ªå®šä¹‰æ•°æ®åŠ è½½ç±»æˆ–è‡ªå®šä¹‰æ•°æ®é›†ç”Ÿæˆå‡½æ•°çš„æ–¹å¼æ¥ç”Ÿæˆæ•°æ®é›†ï¼Œç„¶åé€šè¿‡GeneratorDatasetæ¥å£å®ç°è‡ªå®šä¹‰æ–¹å¼çš„æ•°æ®é›†åŠ è½½ã€‚&lt;/p&gt;
&lt;p&gt;GeneratorDatasetæ”¯æŒé€šè¿‡å¯éšæœºè®¿é—®æ•°æ®é›†å¯¹è±¡ã€å¯è¿­ä»£æ•°æ®é›†å¯¹è±¡å’Œç”Ÿæˆå™¨(generator)æ„é€ è‡ªå®šä¹‰æ•°æ®é›†ï¼Œä¸‹é¢åˆ†åˆ«å¯¹å…¶è¿›è¡Œä»‹ç»ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å¯éšæœºè®¿é—®æ•°æ®é›†
å¯éšæœºè®¿é—®æ•°æ®é›†æ˜¯å®ç°äº†__getitem__å’Œ__len__æ–¹æ³•çš„æ•°æ®é›†ï¼Œè¡¨ç¤ºå¯ä»¥é€šè¿‡ç´¢å¼•/é”®ç›´æ¥è®¿é—®å¯¹åº”ä½ç½®çš„æ•°æ®æ ·æœ¬ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¯è¿­ä»£æ•°æ®é›†
å¯è¿­ä»£çš„æ•°æ®é›†æ˜¯å®ç°äº†__iter__å’Œ__next__æ–¹æ³•çš„æ•°æ®é›†ï¼Œè¡¨ç¤ºå¯ä»¥é€šè¿‡è¿­ä»£çš„æ–¹å¼é€æ­¥è·å–æ•°æ®æ ·æœ¬ã€‚è¿™ç§ç±»å‹çš„æ•°æ®é›†ç‰¹åˆ«é€‚ç”¨äºéšæœºè®¿é—®æˆæœ¬å¤ªé«˜æˆ–è€…ä¸å¯è¡Œçš„æƒ…å†µã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç”Ÿæˆå™¨
ç”Ÿæˆå™¨ä¹Ÿå±äºå¯è¿­ä»£çš„æ•°æ®é›†ç±»å‹ï¼Œå…¶ç›´æ¥ä¾èµ–Pythonçš„ç”Ÿæˆå™¨ç±»å‹generatorè¿”å›æ•°æ®ï¼Œç›´è‡³ç”Ÿæˆå™¨æŠ›å‡ºStopIterationå¼‚å¸¸ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;RGBå›¾åƒæ ¼å¼
rgbå›¾åƒæ˜¯å¸¸è§çš„å½©è‰²å›¾åƒæ ¼å¼ï¼Œä½†ä»–åœ¨è®¡ç®—æœºå†…å­˜ä¸­çš„å­˜å‚¨é¡ºåºé€šå¸¸æ˜¯æŒ‰ç…§BGRçš„é¡ºåºæ’åˆ—çš„ã€‚å› ä¸ºåœ¨Windowså¹³å°ä¸Šï¼Œåƒç´ æ•°æ®æ˜¯æŒ‰ç…§BGRçš„é¡ºåºå­˜å‚¨åœ¨å†…å­˜ä¸­çš„ã€‚å› æ­¤ï¼Œå½“OpenCVä¹‹ç±»çš„å›¾åƒåº“è¯»å–ä¸€å¼ RGBå›¾åƒæ—¶ï¼Œå®ƒä¼šå°†åƒç´ æ•°æ®æŒ‰ç…§BGRçš„é¡ºåºæ’åˆ—åœ¨å†…å­˜ä¸­ï¼Œè€Œä¸æ˜¯RGBçš„é¡ºåºã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;HWCæ ¼å¼
HWCæ ¼å¼æ˜¯æŒ‡æŒ‰ç…§é«˜åº¦ã€å®½åº¦å’Œé€šé“æ•°çš„é¡ºåºæ’åˆ—å›¾åƒå°ºå¯¸çš„æ ¼å¼ã€‚ä¾‹å¦‚ï¼Œä¸€å¼ å½¢çŠ¶ä¸º256Ã—256Ã—3çš„RGBå›¾åƒï¼Œåœ¨HWCæ ¼å¼ä¸­è¡¨ç¤ºä¸º[256, 256, 3]ã€‚åœ¨ä¸€äº›å›¾åƒå¤„ç†åº“æˆ–è€…åº•å±‚æ¡†æ¶ä¸­ï¼Œä¾‹å¦‚OpenCVå’ŒTensorFlowï¼Œé€šå¸¸ä½¿ç”¨HWCæ ¼å¼è¡¨ç¤ºå›¾åƒå°ºå¯¸ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;CHWæ ¼å¼
CHWæ ¼å¼æ˜¯æŒ‡æŒ‰ç…§é€šé“æ•°ã€é«˜åº¦å’Œå®½åº¦çš„é¡ºåºæ’åˆ—å›¾åƒå°ºå¯¸çš„æ ¼å¼ã€‚åœ¨è®¡ç®—æœºè§†è§‰å’Œæ·±åº¦å­¦ä¹ ä¸­ï¼Œé€šå¸¸ä½¿ç”¨CHWæ ¼å¼è¡¨ç¤ºå›¾åƒå°ºå¯¸ã€‚å¦‚PyTorchç­‰ï¼Œå› æ­¤è½¬æ¢CHWæ ¼å¼å’ŒHWCæ ¼å¼æ˜¯æœ‰å¿…è¦çš„ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;å®æˆ˜&lt;/h2&gt;
&lt;pre&gt;&lt;code class="language-python"&gt;import mindspore
from mindspore import nn
from mindspore.dataset import vision, transforms
from mindspore.dataset import MnistDataset
print('mindspore base moudle import')

# mindspore.dataset æ¨¡å—æä¾›apiæ¥åŠ è½½å’Œå¤„ç†å„ç§å¸¸ç”¨æ•°æ®é›†ï¼Œå¦‚MNISTã€CIFAR-10, CIFAR-100, VOC, COCO, ImageNet, CelebA, CLUEç­‰
# å®ƒè¿˜æ”¯æŒæ•°æ®é›†åŒ…æ‹¬ MindRecordã€TFRecordã€Manifestç­‰ã€‚ç”¨æˆ·è¿˜å¯ä»¥å®šä¹‰ä»–ä»¬è‡ªå·±çš„æ•°æ®é›†åœ¨è¿™ä¸ªæ¨¡å—ã€‚æ­¤å¤–ï¼Œè¯¥æ¨¡å—è¿˜æä¾›äº†åœ¨åŠ è½½æ—¶é‡‡æ ·æ•°æ®çš„apiã€‚
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;mindspore base moudle import
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class="language-python"&gt;# MNIST_Dataæ•°æ®é›†ä¸‹è½½
# mnistæ•°æ®é›†æ˜¯ç”±ç¾å›½å›½å®¶æ ‡å‡†ä¸æŠ€æœ¯ç ”ç©¶æ‰€æä¾›çš„æ‰‹å†™æ•°å­—å›¾ç‰‡æ•°æ®é›†
from download import download

url = &amp;quot;https://mindspore-website.obs.cn-north-4.myhuaweicloud.com/&amp;quot; \
      &amp;quot;notebook/datasets/MNIST_Data.zip&amp;quot;
path = download(url, &amp;quot;./&amp;quot;, kind=&amp;quot;zip&amp;quot;, replace=True)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;Downloading data from https://mindspore-website.obs.cn-north-4.myhuaweicloud.com/notebook/datasets/MNIST_Data.zip (10.3 MB)

file_sizes: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 10.8M/10.8M [00:00&amp;lt;00:00, 136MB/s]
Extracting zip file...
Successfully downloaded / unzipped to ./
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class="language-python"&gt;print(MnistDataset.__doc__)
# mnistæ•°æ®é›†åŒ…å«ä»¥ä¸‹å†…å®¹
# mnist_dataset_dir
 # â”œâ”€â”€ t10k-images-idx3-ubyte (10000ä¸ªæµ‹è¯•å›¾ç‰‡)
 # â”œâ”€â”€ t10k-labels-idx1-ubyte (10000ä¸ªæµ‹è¯•æ ‡ç­¾)
 # â”œâ”€â”€ train-images-idx3-ubyte (60000ä¸ªè®­ç»ƒå›¾ç‰‡)
 # â””â”€â”€ train-labels-idx1-ubyte (60000ä¸ªè®­ç»ƒæ ‡ç­¾)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;    MNIST dataset.

    The generated dataset has two columns :py:obj:`[image, label]` .
    The tensor of column :py:obj:`image` is of the uint8 type.
    The tensor of column :py:obj:`label` is a scalar of the uint32 type.

    Args:
        dataset_dir (str): Path to the root directory that contains the dataset.
        usage (str, optional): Usage of this dataset, can be ``'train'`` , ``'test'`` or ``'all'`` .
            ``'train'`` will read from 60,000 train samples, ``'test'`` will read from 10,000 test samples,
            ``'all'`` will read from all 70,000 samples. Default: ``None`` , will read all samples.
        num_samples (int, optional): The number of images to be included in the dataset.
            Default: ``None`` , will read all images.
        num_parallel_workers (int, optional): Number of worker threads to read the data.
            Default: ``None`` , will use global default workers(8), it can be set
            by :func:`mindspore.dataset.config.set_num_parallel_workers` .
        shuffle (bool, optional): Whether or not to perform shuffle on the dataset.
            Default: ``None`` , expected order behavior shown in the table below.
        sampler (Sampler, optional): Object used to choose samples from the
            dataset. Default: ``None`` , expected order behavior shown in the table below.
        num_shards (int, optional): Number of shards that the dataset will be divided into. Default: ``None`` .
            When this argument is specified, `num_samples` reflects the maximum sample number of per shard.
        shard_id (int, optional): The shard ID within `num_shards` . Default: ``None`` . This
            argument can only be specified when `num_shards` is also specified.
        cache (DatasetCache, optional): Use tensor caching service to speed up dataset processing. More details:
            `Single-Node Data Cache &amp;lt;https://www.mindspore.cn/tutorials/experts/en/r2.2/dataset/cache.html&amp;gt;`_ .
            Default: ``None`` , which means no cache is used.

    Raises:
        RuntimeError: If `dataset_dir` does not contain data files.
        ValueError: If `num_parallel_workers` exceeds the max thread numbers.
        ValueError: If `usage` is not ``'train'``ã€``'test'`` or ``'all'``.
        RuntimeError: If `sampler` and `shuffle` are specified at the same time.
        RuntimeError: If `sampler` and `num_shards`/`shard_id` are specified at the same time.
        RuntimeError: If `num_shards` is specified but shard_id is None.
        RuntimeError: If `shard_id` is specified but `num_shards` is None.
        ValueError: If `shard_id` is not in range of [0, `num_shards` ).

    Tutorial Examples:
        - `Load &amp;amp; Process Data With Dataset Pipeline
          &amp;lt;https://www.mindspore.cn/docs/en/r2.2/api_python/samples/dataset/dataset_gallery.html&amp;gt;`_

    Note:
        - The parameters `num_samples` , `shuffle` , `num_shards` , `shard_id` can be used to control the sampler
          used in the dataset, and their effects when combined with parameter `sampler` are as follows.

    .. include:: mindspore.dataset.sampler.txt

    Examples:
        &amp;gt;&amp;gt;&amp;gt; import mindspore.dataset as ds
        &amp;gt;&amp;gt;&amp;gt; mnist_dataset_dir = &amp;quot;/path/to/mnist_dataset_directory&amp;quot;
        &amp;gt;&amp;gt;&amp;gt;
        &amp;gt;&amp;gt;&amp;gt; # Read 3 samples from MNIST dataset
        &amp;gt;&amp;gt;&amp;gt; dataset = ds.MnistDataset(dataset_dir=mnist_dataset_dir, num_samples=3)
        &amp;gt;&amp;gt;&amp;gt;
        &amp;gt;&amp;gt;&amp;gt; # Note: In mnist_dataset dataset, each dictionary has keys &amp;quot;image&amp;quot; and &amp;quot;label&amp;quot;

    About MNIST dataset:

    The MNIST database of handwritten digits has a training set of 60,000 examples,
    and a test set of 10,000 examples. It is a subset of a larger set available from
    NIST. The digits have been size-normalized and centered in a fixed-size image.

    Here is the original MNIST dataset structure.
    You can unzip the dataset files into this directory structure and read by MindSpore's API.

    .. code-block::

        .
        â””â”€â”€ mnist_dataset_dir
             â”œâ”€â”€ t10k-images-idx3-ubyte
             â”œâ”€â”€ t10k-labels-idx1-ubyte
             â”œâ”€â”€ train-images-idx3-ubyte
             â””â”€â”€ train-labels-idx1-ubyte

    Citation:

    .. code-block::

        @article{lecun2010mnist,
        title        = {MNIST handwritten digit database},
        author       = {LeCun, Yann and Cortes, Corinna and Burges, CJ},
        journal      = {ATT Labs [Online]},
        volume       = {2},
        year         = {2010},
        howpublished = {http://yann.lecun.com/exdb/mnist}
        }
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class="language-python"&gt;# æŸ¥çœ‹MNIST_Dataæ•°æ®é›†å†…å®¹

import numpy as np
import matplotlib.pyplot as plt
# åŠ è½½æ•°æ®é›†ï¼ŒåŒ…å«å›¾åƒå’Œæ ‡ç­¾ä¸¤éƒ¨åˆ†
train_dataset = MnistDataset(&amp;quot;MNIST_Data/train&amp;quot;, shuffle=False)
print('dataset:', type(train_dataset))
print('dataset`s cloumns is: ', train_dataset.get_col_names())

def visualize(dataset):
    &amp;quot;&amp;quot;&amp;quot;
    æŸ¥çœ‹æ•°æ®é›†ä¸­éƒ¨åˆ†å†…å®¹ï¼Œè¿™é‡Œæ˜¯å›¾ç‰‡
    Args:
        dataset (_type_): æ•°æ®é›†
    &amp;quot;&amp;quot;&amp;quot;
    figure = plt.figure(figsize=(4, 4))
    cols, rows = 3, 3

    plt.subplots_adjust(wspace=0.5, hspace=0.5)

    for idx, (image, label) in enumerate(dataset.create_tuple_iterator()):
        figure.add_subplot(rows, cols, idx + 1)
        plt.title(int(label))
        plt.axis(&amp;quot;off&amp;quot;)
        plt.imshow(image.asnumpy().squeeze(), cmap=&amp;quot;gray&amp;quot;)
        if idx == cols * rows - 1:
            break
    plt.show()
visualize(train_dataset)

&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;dataset: &amp;lt;class 'mindspore.dataset.engine.datasets_vision.MnistDataset'&amp;gt;
dataset`s cloumns is:  ['image', 'label']
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src="/static/mindspore/blog-doc_quikStarting_files/blog-doc_quikStarting_5_1.png" alt="png" /&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-python"&gt;img, label = next(train_dataset.create_tuple_iterator())
print('the img chw is : ', img.shape) # mnistæ•°æ®ä¸­æ¯å¼ å›¾åƒæ˜¯ä¸€ä¸ª25*25çš„ç°åº¦å›¾
print('the label is : ', label)

def datapipe(dataset: MnistDataset, batch_size: int):
    image_transforms = [
        vision.Rescale(1.0 / 255.0, 0), # å°†å›¾åƒè¿›è¡Œç¼©æ”¾å¤„ç†
        vision.Normalize(mean=(0.1307,), std=(0.3081,)), # å°†å›¾åƒè¿›è¡Œå½’ä¸€åŒ–å¤„ç†
        vision.HWC2CHW() 
    ]
    label_transform = transforms.TypeCast(mindspore.int32)
    
    dataset = dataset.map(image_transforms, input_columns='image')
    dataset = dataset.map(label_transform, input_columns='label')
    dataset = dataset.batch(batch_size)
    return dataset
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;the img chw is :  (28, 28, 1)
the label is :  5
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class="language-python"&gt;# æ•°æ®å¤„ç†
test_dataset = MnistDataset('MNIST_Data/test')

train_dataset = datapipe(train_dataset, 64)
test_dataset = datapipe(test_dataset, 64)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;mindspore.dataset.engine.datasets_vision.MnistDataset
&lt;/code&gt;&lt;/pre&gt;
&lt;h3&gt;ç½‘ç»œæ„å»º&lt;/h3&gt;
&lt;p&gt;ç¥ç»ç½‘ç»œæ¨¡å‹æ˜¯ç”±ç¥ç»ç½‘ç»œå±‚å’ŒTensoræ“ä½œæ„æˆçš„ï¼Œmindspore.nn æä¾›äº†å¸¸è§ç¥ç»ç½‘ç»œå±‚çš„å®ç°ï¼Œåœ¨MindSporeä¸­ï¼ŒCellç±»æ˜¯æ„å»ºæ‰€æœ‰ç½‘ç»œçš„åŸºç±»ï¼Œä¹Ÿæ˜¯ç½‘ç»œçš„åŸºæœ¬å•å…ƒã€‚ä¸€ä¸ªç¥ç»ç½‘ç»œæ¨¡å‹è¡¨ç¤ºä¸ºä¸€ä¸ªCellï¼Œå®ƒç”±ä¸åŒçš„å­Cellæ„æˆã€‚ä½¿ç”¨è¿™æ ·çš„åµŒå¥—ç»“æ„ï¼Œå¯ä»¥ç®€å•åœ°ä½¿ç”¨é¢å‘å¯¹è±¡ç¼–ç¨‹çš„æ€ç»´ï¼Œå¯¹ç¥ç»ç½‘ç»œç»“æ„è¿›è¡Œæ„å»ºå’Œç®¡ç†ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å®šä¹‰æ¨¡å‹ç±»
å½“æˆ‘ä»¬å®šä¹‰ç¥ç»ç½‘ç»œæ—¶ï¼Œå¯ä»¥ç»§æ‰¿ nn.Cell ç±»ï¼Œåœ¨__init__æ–¹æ³•ä¸­è¿›è¡Œå­Cellçš„å®ä¾‹åŒ–å’ŒçŠ¶æ€ç®¡ç†ï¼Œåœ¨construct(æ„é€ )æ–¹æ³•ä¸­å®ç°Tensoræ“ä½œã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;constructæ„ä¸ºç¥ç»ç½‘ç»œï¼ˆæˆ–è®¡ç®—å›¾ï¼‰æ„å»ºï¼Œç›¸å…³å†…å®¹è¯¦è§ä½¿ç”¨é™æ€å›¾åŠ é€Ÿã€‚construct()æ–¹æ³•ä¸å¯ç›´æ¥è°ƒç”¨&lt;/strong&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-python"&gt;class Net(nn.Cell):
    def __init__(self):
        super().__init__()
        self.flatten = nn.Flatten()
        self.dense_relu_sequential = nn.SequentialCell(
            nn.Dense(28*28, 512),
            nn.ReLU(),
            nn.Dense(512, 512),
            nn.ReLU(),
            nn.Dense(512, 10)
        )
        
    def construct(self, x):
        x = self.flatten(x)
        logits = self.dense_relu_sequential(x)
        return logits
model = Net()
# æŸ¥çœ‹ç¥ç»ç½‘ç»œç»“æ„
print(model)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;Net&amp;lt;
  (flatten): Flatten&amp;lt;&amp;gt;
  (dense_relu_sequential): SequentialCell&amp;lt;
    (0): Dense&amp;lt;input_channels=784, output_channels=512, has_bias=True&amp;gt;
    (1): ReLU&amp;lt;&amp;gt;
    (2): Dense&amp;lt;input_channels=512, output_channels=512, has_bias=True&amp;gt;
    (3): ReLU&amp;lt;&amp;gt;
    (4): Dense&amp;lt;input_channels=512, output_channels=10, has_bias=True&amp;gt;
    &amp;gt;
  &amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class="language-python"&gt;from datetime import datetime
import pytz
print(datetime.now(pytz.timezone('Asia/Shanghai')))
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;2024-06-28 21:12:18.029531+08:00
&lt;/code&gt;&lt;/pre&gt;
</content><category term="MindSpore"/></entry></feed>